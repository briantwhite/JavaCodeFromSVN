5/7/08
started over

5/8/08
got CharacterSpecBank to output all possible character-trait combos

5/19/08
got recombination working

parents:
Genetic Model: XX/XY sex linkage
Autosome:
Two Allele Simple Dominance; Eye:Color:Brown is recessive, Eye:Color:Purple is dominant.
recombination frequency = 0.1 to:
Two Allele Simple Dominance; Antenna:Shape:Pointy is recessive, Antenna:Shape:Short is dominant.
*******
Sex Chromosome:
*******
$$$$$$$$

mom:
Organism: [female]
Genotype:
Maternal auto:
Brown-Eye;Pointy-Antenna
Paternal auto:
Purple-Eye;Short-Antenna
Maternal sex chr:

Paternal sex chr:

Phenotypes:
Eye:Color:Purple
Antenna:Shape:Short
pheno string=Purple-Eye/Short-Antenna
**organism**

dad:
Organism: [male]
Genotype:
Maternal auto:
Brown-Eye;Pointy-Antenna
Paternal auto:
Brown-Eye;Pointy-Antenna
Maternal sex chr:

Paternal sex chr:
null sex chromosome
Phenotypes:
Eye:Color:Brown
Antenna:Shape:Pointy
pheno string=Brown-Eye/Pointy-Antenna
**organism**

100 offspring

Purple-Eye/Pointy-Antenna: 5, 5 males, 0 females
Purple-Eye/Short-Antenna: 45, 25 males, 20 females
Brown-Eye/Short-Antenna: 12, 5 males, 7 females
Brown-Eye/Pointy-Antenna: 42, 12 males, 30 females

this gives rf = (12 + 5)/100 = 17% 
real rf = 10% this is pretty close!

another try
1000 offspring
Genetic Model: XX/XY sex linkage
Autosome:
Two Allele Simple Dominance; Antenna:Shape:Knobbed is recessive, Antenna:Shape:Bent is dominant.
recombination frequency = 0.1 to:
Two Allele Simple Dominance; Antenna:Color:Red is recessive, Antenna:Color:Green is dominant.
*******
Sex Chromosome:
*******
$$$$$$$$

mom:
Organism: [female]
Genotype:
Maternal auto:
Knobbed-Antenna;Green-Antenna
Paternal auto:
Bent-Antenna;Red-Antenna
Maternal sex chr:

Paternal sex chr:

Phenotypes:
Antenna:Shape:Bent
Antenna:Color:Green
pheno string=Bent-Antenna/Green-Antenna
**organism**

dad:
Organism: [male]
Genotype:
Maternal auto:
Knobbed-Antenna;Red-Antenna
Paternal auto:
Knobbed-Antenna;Red-Antenna
Maternal sex chr:
null sex chromosome
Paternal sex chr:

Phenotypes:
Antenna:Shape:Knobbed
Antenna:Color:Red
pheno string=Knobbed-Antenna/Red-Antenna
**organism**

kids:

results:
Bent-Antenna/Red-Antenna: 468, 280 males, 188 females
Knobbed-Antenna/Green-Antenna: 440, 198 males, 242 females
Bent-Antenna/Green-Antenna: 53, 29 males, 24 females
Knobbed-Antenna/Red-Antenna: 43, 15 males, 28 females

gives rf = (53 + 43)/1000 = 9.6% 
looks like it works

do a 3-point cross
blue short brown/yel long black
10% rf between each

NR
Blue-Eye/Short-Antenna/Brown-Body: 385, 281 males, 104 females
Yellow-Eye/Long-Antenna/Black-Body: 404, 114 males, 290 females

single at 1st
Blue-Eye/Long-Antenna/Black-Body: 54, 29 males, 25 females
Yellow-Eye/Short-Antenna/Brown-Body: 60, 25 males, 35 females

single at 2nd
Blue-Eye/Short-Antenna/Black-Body: 43, 32 males, 11 females
Yellow-Eye/Long-Antenna/Brown-Body: 49, 19 males, 30 females

doubles
Blue-Eye/Long-Antenna/Brown-Body: 6, 4 males, 2 females
Yellow-Eye/Short-Antenna/Black-Body: 7, 2 males, 5 females

looks OK
the doubles are the least freq

rf1 (should be 10%) is (54 + 60 + 6 + 7)/1000 = 12.7%
rf2 (should be 10%) is (43 + 49 + 6 + 7)/1000 = 10.5%
 doubles should be 1% is 13/1000 = 1.3%
 
looks OK
but what if rf1 is usually higher than rf2?
try again

bent yel brn/norm pur yel
10% b/w each
1000 offspring

NR
Bent-Body/Yellow-Body/Brown-Leg: 407, 278 males, 129 females
Normal-Body/Purple-Body/Yellow-Leg: 410, 125 males, 285 females

single at 1st
Bent-Body/Purple-Body/Yellow-Leg: 50, 33 males, 17 females
Normal-Body/Yellow-Body/Brown-Leg: 37, 10 males, 27 females

single at 2nd
Bent-Body/Yellow-Body/Yellow-Leg: 47, 34 males, 13 females
Normal-Body/Purple-Body/Brown-Leg: 44, 6 males, 38 females

doubles
Bent-Body/Purple-Body/Brown-Leg: 8, 5 males, 3 females
Normal-Body/Yellow-Body/Yellow-Leg: 5, 1 males, 4 females

again looks OK

rf1 (10%) = (50 + 37 + 8 + 5)/1000 = 10.0%
rf2 (10%) = (47 + 44 + 8 + 5)/1000 = 10.4%
now, rf2 is higher
so it was probably a statistical fluke

but something strange - the sex ratios are rather skewed
and reciprocally skewed in  reciprocal classes...
shouldn't be linked (this is strictly autosomal)

also the total is not 1000
fixed bug in cage
	it was counting the first member of each phenotype twice...
try again
now getting 1000 organisms always

but still getting sex ratios that are almost 2:1
but not always...

maybe its a Random thing
put random in the constructor of ChromosomeModel
rather than making a new one each time you call getOffspring or getRandomOrg
looks better

green bent 5/pur short two
10% rf b/w each

NR
Green-Antenna/Bent-Body/Five-Leg: 394, 218 males, 176 females
Purple-Antenna/Short-Body/Two-Leg: 409, 218 males, 191 females

single at 1st
Green-Antenna/Short-Body/Two-Leg: 41, 27 males, 14 females
Purple-Antenna/Bent-Body/Five-Leg: 51, 26 males, 25 females

single in 2nd
Green-Antenna/Bent-Body/Two-Leg: 48, 24 males, 24 females
Purple-Antenna/Short-Body/Five-Leg: 45, 20 males, 25 females

double
Purple-Antenna/Bent-Body/Two-Leg: 8, 4 males, 4 females
Green-Antenna/Short-Body/Five-Leg: 4, 2 males, 2 females

looks much better

now try diff rfs
10% then 20%

brn brn blk/blk blk red

NR
Brown-Leg/Brown-Body/Black-Eye: 353, 180 males, 173 females
Black-Leg/Black-Body/Red-Eye: 391, 196 males, 195 females

single at 1
Brown-Leg/Black-Body/Red-Eye: 37, 16 males, 21 females
Black-Leg/Brown-Body/Black-Eye: 39, 19 males, 20 females

single at 2
Brown-Leg/Brown-Body/Red-Eye: 92, 40 males, 52 females
Black-Leg/Black-Body/Black-Eye: 67, 37 males, 30 females

double
Brown-Leg/Black-Body/Black-Eye: 12, 5 males, 7 females
Black-Leg/Brown-Body/Red-Eye: 9, 7 males, 2 females

rf1 (should be 10%) = (37 + 39 + 12 + 9)/1000 = 9.7%
rf2 (should be 20%) = (92 + 67 + 12 + 9)/1000 = 18.0%
double (should be 2%) = (12 + 9)/1000 = 2.1%
yahoo!


6/9/08
started linking to VGL
made package VGL & put all VGL stuff there
put in /Resources
went to http://www.jdom.org/ to get jdom 1.1.tar.gz
	exploded on desktop
	cd Desktop/jdom1.1
	setenv JAVA_HOME /usr/
	./build.sh
	- it made build/jdom.jar
	- put that in VGLII
	- in VGLII properties, add Jar 
		select jdom.jar
	Now AOK!

start the migration
1) nuke all model stuff in VGL

2) in GM.organism, add stuff from VGL.organism
	- id, cageId, constructors

3) nuke VGL.organism and make VGL's refs refer to GM.organism
	- makes many bugs
		go thru & delete all stuff for reading/saving to/from files
			(didn't finish this..)

4) do same with VGL.OList and GM.OrganismList
	- add get() and find()
	
5) nuke VGL.Traits, VGL.Configuration

6) go back and finish removing the load/save stuff (for now)
   & fix bugs as you find them to make it work

nuke VGL.Genetics

6/10/08
- go thru and change all the m_fred to fred
- re-worked CageUI for new stuff
- also put in the gpl header to all classes
- reworked VGLII (nuked VGLMain and VGLMainApp)

6/12/08
- got it working in jar with pix and text only in dialogs (no pix yet)
- nuked useless phenotype pix

the jdom stuff failed as a jar...
made lib/ 
	put in stuff from VGL/lib
	in properties, add Class Folder
	edited build.xml to include lib
	- now OK

it can read in simple files!

Format: all are floats between 0 and 1 (if not specified, they default to 0)

minimal file:
<?xml version="1.0" encoding="UTF-8"?>
<root>
	<ZZ_ZW>0.0</ZZ_ZW>
</root>

- first, set the overall sex determining mechanism
   even if not sex-linked
   
	* ZZ_ZW - chance of ZZ/ZW sex linkage

- then the first gene - there must be at least one
	* Gene1_SexLinked - chance that it'll be sex-linked
							(if not, it'll be autosomal)
	* Gene1_3Alleles - 	chance it's 3-alleles
							(if not, it'll be 2 allele)
	* Gene1_IncDom  - 	chance it's inc dom
							(if not and 2 allele - simple dom)
							(if not and 2 allele 50/50
								chance of hierarch/circ dom)
								
- second gene - may or may not be there
	* Gene2_Present -	chance it's present
							(if not, it's a 1 gene model)
	* Gene2_SameChrAsGene1	- chance gene2 and 1 are on same chromo
								(if not, they are on different ones)
								(that is, sex vs auto)
	* Gene2_MinRfToGene1	- range of possible recombination freqs
	* Gene2_MaxRfToGene1		(between gene 1 and gene 2 if on same chromo)
	
	* Gene2_3Alleles		- same as above
	* Gene2_IncDom
	
- third and final gene - may or may not be there
	* Gene3_Present	- 	chance it's present
							(if not, it's a 2 gene model)
	* Gene3_SameChrAsGene1	- same as above
	* Gene3_MinRfToGene1
	* Gene3_MaxRfToGene1
	* Gene3_3Alleles
	* Gene3_IncDom

6/13-rw-r--r--  1 brian  admin  147 Jun 13 12:50 OneGeneAutoIncDom.prb
-rw-r--r--  1 brian  admin  147 Jun 13 12:49 OneGeneIncDom.prb
-rw-r--r--  1 brian  admin  147 Jun 13 12:50 OneGeneSLIncDom.prb
-rw-r--r--  1 brian  admin  113 Jun 13 12:45 OneGeneSimpleAutosomal.prb
-rw-r--r--  1 brian  admin  113 Jun 13 12:44 OneGeneSimpleDominance.prb
-rw-r--r--  1 brian  admin  113 Jun 13 12:45 OneGeneSimpleSexLinked.prb
-rw-r--r--  1 brian  admin  476 Jun 13 12:58 ThreeLinkedAutosomalGenes.prb
-rw-r--r--  1 brian  admin  476 Jun 13 12:59 ThreeSexLinkedGenes.prb
-rw-r--r--  1 brian  admin  292 Jun 13 12:53 TwoAutoGenesIndep.prb
-rw-r--r--  1 brian  admin  292 Jun 13 12:54 TwoAutoGenesLinked.prb
-rw-r--r--  1 brian  admin  292 Jun 13 12:55 TwoGenesMixed.prb

sent to Peter Russell (yeast@reed.edu) & Harry Roy (royh@rpi.edu)
for testing and feedback

Harry's new problem opens in his home dir - not in Problems...

got beginner mode working

added parameter BeginnerMode (True/False)

6/16/08
- working on beginner mode:
	- have balloon help always appear in beginnerMode and show only genotype
		never show phenotype and never in non beginnerMode

- added parameters MinOffspring; MaxOffspring

renamed params
	* Gene3_MinRfToGene1 - Gene3_MinRfToPrevGene
	* Gene3_MaxRfToGene1 - Gene3_MaxRfToPrevGene
since it's linkage to either gene 2 (of 1 and 2 are linked) or to 1 (if 1 and 2 aren't)

working on summary chart
- need a way to show that a cage has been added to the selected set of cages
	for summarizing
- shift-click toggles this addition
- this is indicated by a change in background color

6/17/08
set it so that the traits are listed in random order when shown in CageUI

working on summary chart
- got it working!

6/18/08
misc fixes
- add unselect all to utilities menu
- in beginner mode "Show Genetic Model" (not "show model & genotypes")
- use scrambled phenotype order for phenotype string
	that way, it will sort properly in the CageUI
- have it deal properly when you try to make a summary chart with no
	selected cages
- tested three allele models
	needed to fix ThreeAlleleIncDom
- made all models print their descriptions nicely
- got print to file and print to printer working
- started working on save work to file

6/19/08
- more work on saving to file

6/23/08
- got saving and opening work files to work!

6/24/08
fixes as per e-mail from Peter Russell yeast@reed.edu
Hi Brian
    I've now had a chance to look at your beta version and think it has great promise.  
    It certainly seemed to have the same feels as GCK as one worked through a problem.   
I tried a couple of the multiple gene problems - 2 genes linked and 3 genes linked and 
can offer some comments, all of which are basically details rather than fundamental:

(1) I assume in the final, problems will be coded as in VGL1 so that the genetics 
involved is not presented?  It would also be handy, although not essential, if 
the Problems shown as options could be selected by the instructor.

(2) Problems generated phenotypes that were presented as "Normal".  If I remember 
correctly, GCK avoided that explicitly so that students would not immediately 
assume that Normal is the wild-type trait.   I suggest not using Normal as a 
phenotype but following the GCK model.  

(3) In some Problems that popped up, the same specific phenotype appeared for two 
different traits - in a specific case, Black was a phenotype for two traits in a 
three-gene mapping problem.  Obviously that is going to be confusing to students, 
or at least a complication for assigning gene symbols or discussing the problem in 
classroom presentations.  Again, I hadn't seen that happen in GCK, but encourage 
finding a way to avoiding it.

(4) The most serious issue I saw, and it is also the case with VGL1, is that 
there are not enough flies generated at times and seemingly there is no way
 to set that as a Preference.  If I recall correctly, GCK out of the blocks
  had the same issue, so we set the preferences for higher offspring populations.   
  This is particularly important for the mapping problems where we are trying to 
  instill an appreciation of statistics and accuracy, but I also see the low 
  numbers as a limitation in some of the simpler problems where in some cases 
  just a few flies appeared, and not always in both sexes, in the starting cage.  
  The latter issue adds a complication for making true-breeding populations, for 
  instance, which we'd prefer to avoid in our mixed majors-nonmajors intro bio course.

(5) In both VGL2 and 1, there is a typo in the menus -- Utilities is misspelt.

(6) On your http://intro.bio.umb.edu/vgl/ page:
    -  in the second paragraph "compatible" is misspelt. 
    - in the third paragraph, I assume "autonomic" should be "autosomal"


(I numbered them)

(1) I'll let them change the problem file names
(2) change "normal" shape to "forked"
(5) fixed
(4) had already added min and max offspring parameters; set them higher in 3-gene
    problems
(3) 2 things:
   - add a new BristleTrait to allow more options
   - set up CharSpecBank and CharSpec to prevent two color traits (etc)
   		once a colortrait is chosen, all colortraits are removed from
   		the other lists

- fixed bug in CageUI - if more than 40 offspring, it'd blow up
	it was hard-coded to 2 rows of 20
	so fixed it to 2 rows of (most possible offspring of 1 pheno)/2
	
- this may lead to trouble with lots of offspring (very long cages!)
	therefore, cap min and max offspring at 100. (do in ProblemTypeSpecification)
	
- set it to save work as zip files so that they can't cheat by looking ar work file
   to see model
   
Revised parameters <NOTE LATER REVISION>
- first, set the overall sex determining mechanism
   even if not sex-linked
	* ZZ_ZW - chance of ZZ/ZW sex linkage

- then some overall issues
	* BeginnerMode - True or False - allows users to see the genetic model
					by clicking on button in field pop cage
					and see genotypes of organisms (tool tip text)
	
	* MinOffspring - minimum number produced in each cage (capped at 100)
					- actual number is randomly distributed between these
	* MaxOffspring - maximum number produced in cage (capped at 100)

- then the first gene - there must be at least one
	* Gene1_SexLinked - chance that it'll be sex-linked
							(if not, it'll be autosomal)
	* Gene1_3Alleles - 	chance it's 3-alleles
							(if not, it'll be 2 allele)
	* Gene1_IncDom  - 	chance it's inc dom
							(if not and 2 allele - simple dom)
							(if not and 2 allele 50/50
								chance of hierarch/circ dom)
								
- second gene - may or may not be there
	* Gene2_Present -	chance it's present
							(if not, it's a 1 gene model)
	* Gene2_SameChrAsGene1	- chance gene2 and 1 are on same chromo
								(if not, they are on different ones)
								(that is, sex vs auto)
	* Gene2_MinRfToGene1	- range of possible recombination freqs
	* Gene2_MaxRfToGene1		(between gene 1 and gene 2 if on same chromo)
	
	* Gene2_3Alleles		- same as above
	* Gene2_IncDom
	
- third and final gene - may or may not be there
	* Gene3_Present	- 	chance it's present
							(if not, it's a 2 gene model)
	* Gene3_SameChrAsGene1	- same as above
	* Gene3_MinRfToGene1
	* Gene3_MaxRfToGene1
	* Gene3_3Alleles
	* Gene3_IncDom

- fixed up help so it matches new software

- VERSION 1.0!!!

6/25/08
misc fixes
- change .prb to .pr2 and .wrk to .wr2
	so there's no confusion with original VGL
- put <BeginnerMode>False</BeginnerMode> in all problem files

setting up to have it work by double-clicking work and problem files to launch VGLII
- had it deal with command-line arguments of filename

renamed problem files LevelXXp.pr2 = LevelXX.pr2 with practice mode enabled

- Level01.pr2 = One Autosomal Gene; 2 Alleles, Simple Dominance 
- Level02.pr2 = One Autosomal Gene; 2 Alleles, Incomplete Dominance
- Level03.pr2 = One XX/XY Sex-linked Gene; 2 Alleles, Simple Dominance
- Level04.pr2 = One XX/XY Sex-linked Gene; 2 Alleles, Incomplete Dominance
- Level05.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 2 Alleles, Simple Dominance
- Level06.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 2 Alleles, Incomplete Dominance
- Level07.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 3 Alleles 
								(Incomplete, Hierarchical, or Circular dominance)
- Level08.pr2 = One Gene (Autosomal, XX/XY Sex-Linked, ZZ/ZW Sex-Linked);
				(2 or 3 Alleles); (Incomplete, Hierarchical, or Circular dominance)

- Level09.pr2 = Two Unlinked Autosomal Genes; 2 Alleles each; Simple Dominance
- Level10.pr2 = Two Linked Autosomal Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple Dominance
- Level11.pr2 = Two Genes, either XX/XY Sex-Linked or Autosomal; 2 Alleles each; 
					Simple dominance

- Level12.pr2 = Three Linked Autosomal Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple dominance
- Level13.pr2 = Three Sex-Linked Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple dominance

6/26/08
- set save/open work and print to file to go to Desktop
- set it to show warning dialog if you try to open a bad file

6/27/08
fixing bugs
- summary chart persists even after you close the work
	*close work and new problem should clear it out and nuke the ui
		- add to VGLII's cleanUp() method

- if you close problem, select "save" and then cancel in the file dialog
	you lose your work
	* change cleanUp() to return

- try to make the .pr2 files zipped for security
	zip Test Level01.pr2
	mv Test.zip Test.pr2
	- recode reader
	WORKS!
	
	need to cleverly zip all files individually and rename
	first, right-click each file in finder & make archive
	then delete the originals
	then trim the extension:
	ls *.zip | sed 's/\(.*\)\.zip/  & \1/' | xargs -L1 mv

Version 1.0.1

6/29/08
started making pheno images
put boolean in cageUI to show/not-show these as they are being developed
set to false for release versions until all ready

6/30 & 7/1 
working on drawing pix

7/2/08
nuked the Bristle trait - too hard to draw
added in Wing as a body part (it had been there but not added to CharSpecbank)
- now saves Wing problems properly

- reset ImageMaker's defaults on new and open problem

got it all working!

version 1.1.0

9/26/08
had screwed up cvs so that it lost jdom
	messed it up when making PhylogenySurvey

fixed it

request for new problem file: emhowe@assumption.edu

With GCK, what I like about the program is that it allows me to create dihybrid problems 
(i.e. two traits that are unlinked or linked, depending on my intention). I also like the 
flexibility of having the dihybrid problems randomized. For example, I have it set up so 
that when a student starts a dihybrid problem, he/she is presented with two traits and the 
respective phenotypes given for each of the traits. They have to solve each trait independently 
(if they are ostensibly unlinked), and the way in which the problem is set up could have either 
of the two traits randomly start as a simple dominant model, a codominant model or a 
sex-linkage model. This system allows for students to have to figure out which model is 
appropriate for solving each trait. Of course, students also must determine how genotypes 
match to phenotypes for each trait, depending on the model they propose.

made Level11-1.pr2 - same as level 11 except 50/50 chance of inc dom for each gene


10/25/08
weird bug from Harry Roy
get cages with only males!
this is reproducible - re-crossing parents gives all males
also crossing these males with random females gives only males!

  <GeneticModel XX_XYSexDetermination="false" 
  	BeginnerMode="false" 
  	NumberOfCharacters="3" 
  	MinOffspring="40" 
  	MaxOffspring="70">

in saved file, cage 105 (id = 104) has these:
        <Organism Id="0" CageId="104" Male="true">
          <Chromosome Id="MaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="2" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="PaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="1" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="MaternalSexChromosome" Size="0" />
          <Chromosome Id="PaternalSexChromosome" Size="0" />
        </Organism>
        
- this should've been an xx/xy sex-linked system
the first organisms are sexed that way:

        <Organism Id="23" CageId="0" Male="true">
          <Chromosome Id="MaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="1" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="PaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="1" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="MaternalSexChromosome" Size="-1" />
          <Chromosome Id="PaternalSexChromosome" Size="0" />
        </Organism>
        
        <Organism Id="21" CageId="0" Male="false">
          <Chromosome Id="MaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="1" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="PaternalAutosome" Size="3">
            <Allele GeneIndex="0" TraitNumber="1" />
            <Allele GeneIndex="1" TraitNumber="1" />
            <Allele GeneIndex="2" TraitNumber="1" />
          </Chromosome>
          <Chromosome Id="MaternalSexChromosome" Size="0" />
          <Chromosome Id="PaternalSexChromosome" Size="0" />
        </Organism>

somehow, it got switched - maybe it's in how the work is saved & re-loaded
sometimes I use Boolean.parseBoolean(e.getAttributeValue())
sometimes I use e.getAttribute().getBooleanValue()
maybe its a strange thing there...

this may be it: in GeneticModel, I save the sex linkage type as 'XX_XYSexDetermination'
but, in WorkFileProcessor, I look for 'XX_XYSexLinkage'
and, if I use 
	e.getAttribute("XX_XYSexLinkage").getBooleanValue());
	this throws an error
	but the code I used:
		Boolean.parseBoolean(e.getAttributeValue("XX_XYSexLinkage"))
		does not 
		
so, if you save, reopen, and save again, it should mess up the sex-linkage
test:
open a level 11 problem (no way to be zz/zw)
save
	first line:
	  <GeneticModel XX_XYSexDetermination="true" 
	  BeginnerMode="false" 
	  NumberOfCharacters="2" 
	  MinOffspring="25" MaxOffspring="35">
	
reopen and save again
	first line
	  <GeneticModel XX_XYSexDetermination="false"  - NOTE NOW FALSE!!! THIS IS THE BUG!
	  BeginnerMode="false" 
	  NumberOfCharacters="2" 
	  MinOffspring="25" MaxOffspring="35">
	
fix work file processor to look for 'XX_XYSexDetermination'
test
open level 11 problem
cross once
save
	<GeneticModel XX_XYSexDetermination="true"
reopen
cross again
save
	<GeneticModel XX_XYSexDetermination="true"

it must be that Boolean.parseBoolean(e.getAttributeValue("XX_XYSexDetermination"))
	gives "false" when getAttributValue() returns null
therefore, use the safer version e.getAttribute().getBooleanValue()

now AOK!

another bug - RFs in Level12 are always identical
fixed code in WorkFileProcessor.processChromosomeModelInfo
	it was reading in and losing all but the last RF

check to be sure all work file param names match in save, read, and the file
order: GeneticModel.save(); WorkFileProcessor.processSavedModelInfo(); work.txt
- GeneticModel; GeneticModel; GeneticModel {OK}
- XX_XYSexDetermination; XX_XYSexDetermination; XX_XYSexDetermination {OK}
- BeginnerMode; BeginnerMode; BeginnerMode {OK}
- NumberOfCharacters; NumberOfCharacters; NumberOfCharacters {OK}
- MinOffspring; MinOffspring; MinOffspring {OK}
- MaxOffspring; MaxOffspring; MaxOffspring {OK}
- CharacterOrderScrambler; CharacterOrderScrambler; CharacterOrderScrambler {OK}
- Character; - not tested -; Character {OK}
- Index; Index; Index {OK}
- ChromosomeModel; ChromosomeModel; ChromosomeModel {OK}
- SexChromosome; SexChromosome; SexChromosome {OK}
- NumGenes; - not read -; NumGenes {OK}
- checked GeneModels to be sure they save the right name string {OK}
- RfToPrevious; RfToPrevious; RfToPrevious {OK}

all should be OK now

made version 1.1.1

4/21/09
Bug - summary chart buttons do not always respond to clicks by changing the table!
- it is throwing 
     [java] Exception in thread "AWT-EventQueue-0" java.lang.ArrayIndexOutOfBoundsException: 2
     [java] 	at GeneticModels.OrganismList.getCustomPhenotypeString(OrganismList.java:137)
     [java] 	at VGL.SummaryChartManager.calculateTotals(SummaryChartManager.java:103)
the code there is crazy - it's doing the lookup backwards:
					phenos.get(
							traitsToCount[scrambledTraitOrder[i]])
should be get(scrambledTraitOrder[traitsToCount[i]])
	fixed in 2 places in this method
changed but still not right - no more error but
	- counts are right and labels in table of counts match
	- checkbox labels in right order and they change the table but
		- the labels don't correspond to the traits they select!

changed OList - look up not by scrambled since it's the trait's index we want
	- also, need to output trait names in scrambled order
	fixed SummaryChartManager & SummaryChartUI
- seems to work

4/22/09
bug - on pc, double-clicking a Cage does not make it turn yellow...
	although it is selected (you just can't tell).

can't get the background color to change on the pc
so just change to a colored border to show selection

4/30/09
added VGL team info to the About dialog

added in code for new phenotype images
edited it for style and removed print statements
version 1.2.0

9/2/09
starting to internationalize - externalized strings from VGLII class as a test

9/9/09
make separate help directories for different languages
access them with a line in the VGL/messages.properties VGLII.HelpFileDir=Help  (or Help_fr) etc.
html files must be UTF-8 format for the accented characters to work

9/15/09
the .properties files must have unix line breaks and be ISO-8559-1
got it working
also, the menus & toolbar must not be made new each time but removeAll() works

now, need to go class-by-class to get all the other UI strings
- in package VGL:
CageManager
CageUI
CustomizedFileFilter - not needed
DocumentRenderer - not needed
ExpertiseLevel - deleted class (not needed anymore!)
GeneticModelAndCageSet - not needed
GeneticsException - not needed
IndividualPanelSet - not needed
LanguageSpecifierMenuItem - not needed
MFTotCounts - not needed
OrganismUI 
PhenotypeCount - not needed
SelectionVial
ShowPhenotypeButton - not needed
SummaryChartManager
VGL

- in package Phenotypemages - don't do any here

- in package GeneticModels:
Allele - not needed (just for export)
AutosomeModel - none
Cage - just the printing ones
CharacterSpecification - none
CharacterSpecificationBank - important ones are here
Chromosome - not needed
ChromosomeModel - some for printing & describing
ColorTrait - some
ColorTraitSet - important ones
GeneModel - none
GeneticModel - only for printing
GeneticModelFactory - error messages
GeneticsException - none
NullAlleleList - none
NullSexChromosome - none
NullTrait - none
NumberTrait - some
NumberTraitSet - important ones
Organism - a few for printing
OrganismFactory - none (just for export)
OrganismList - none
Phenotype - none
ProblemTypeSpecification - none
SexChromosomeModel - none
ShapeTrait - some
ShapeTraitSet - important ones
ThreeAlleleCircularDominanceGeneModel - stuff for printing
ThreeAlleleHierarchicalDominanceGeneModel - ditto
ThreeAlleleIncompleteDominanceGeneModel - ditto
Trait - none
TraitFactory - none
TraitSet - none
TwoAlleleIncompleteDominanceGeneModel - stuff for printing
TwoAlleleSimpleDominanceGeneModel - ditto
WorkFileProcessor - none

9/19/09
oops
didn't want to change the internal names 
	if you do, you'll break the pheno drawing
	so undo most of the changes in GeneticModels

ugh
STEP 1: make it work but don't translate phenotypes
	just be sure the labels etc work
	(then, later put in the translations of the phenotype names)
CharacterSpecificationBank - many
ColorTrait
ColorTraitSet
NumberTrait
NumberTraitSet
ShapeTrait
ShapeTraitSet

STEP 2: make a Messages.translatePhenotypeName(string)
	build this in where needed - only at display
		(all the internals are in english 
			- that way, the pheno pix work)
			
build into
CageUI -ok
to get the tool tip text right in practice mode: Chromosome, Organism - OK
to get the printing right: Organism, VGLII - OK

9/22/09
oops - put ALL the code that switches noun and adjective should be in Messages
	took it out of: Organism & Chromosome

get summary chart to work - SummaryChart & SummaryChartUI - ok
get model description in practice mode to work - 
	do for each of the GeneModels
	got all 5 working

9/23/09
get CageUI's parents panel working
also phenotype images

this will be version 2.0.0

9/24/09
text to translate for the figures:
- These are the characters involved in this problem
- The numbers here indicate the number of males and females of each type
- All of the organisms here have five wings and blue eyes.
- These are the traits of each character that each type of organism displays.
- Clicking on the "Images" button for a particular type will show a picture of that type of organism like this:
- Click this button to close the image
- These indicate the organisms selected as parents for Cage 2
- These are the offspring of the parents selected in Cage 1 above:
- These indicate the parents of the offspring in Cage 2; they can be clicked on to identify them in their original Cage.
- Holding the cursor over an organism will pop up a display of its genotype:
- Click here to show/hide the details of the genetic model:

9/29/09
- fixed text size in french help (it was too big)
- added note in close cage warning that you can get this back from Utilities->Cages
- added boolean to VGLII so that it doesn't ask to save if it hasn't changed (a cross only)
	since last save
	
posted as version 2.0.0 on website

10/10/09
fixing various bugs that Sophie Javerzat found
1) When warning about closing a cage, there's an extra "?" (messages_fr_FR.propreties)
2) it is Amit Kumar not Kuma (VGLII.java)
3) fig0.gif is missing in french help (made new one)
4) html print-to-file of work don't show accents - probably a utf-8 thing
    (print regular does not have this problem) fixed to ISO-8859-1 in VGLII.java
    
10/16/09
can't find help file on pc version!
- you always use a "/" for finding files in a jar  - even if on PC!

made version 2.0.1

11/17/09
Got spanish translations from Juan-Carlos Hernï¿½ndez-Vega

11/21/09
working on spanish translation

1/21/10
spanish is working version 2.0.2

6/8/10
working on upgrades
1) better encryption for the .wr2 files (since we may use them for graded homework)
- use XOR to a fairly long key (see http://www.stratos.me/2008/07/java-xor-encryption/)

need to set up in
	VGLII.java (for saving)
	GeneticModelFactory.readModelFromFile (for loading)
need to be backward compatable - be able to load un-encrypted (but zipped) .wr2 files from earlier versions
	maybe use the filename in the zip? it is currently called "work.txt"
	if name is "work.txt" don't decrypt
	if name is "encrypted.txt" do decrypt
		save all new work files as encrypted.txt
- all set
	it now writes all encrypted
	but can read both

6/15/10
bug - on reading in the SECOND work file, it hangs
problem found when making the VGLIIProblemFileReader

Add line 81 to WorkFileProcessor: CharacterSpecificationBank.getInstance().refreshAll();

now is AOK

7/2010
trouble in other languages that weren't supported with a .properties file
it would die since it couldn't find the right file

modify Messages so that it checks on instantiation and defaults to english
need to fix all refs from Messages.get to Messages.getInstance().get

started adding in Korean stuff from 
Se Jin Youn
Hansung Science High School
san 5, Hyeonjeo dong, Seodaemun gu
Seoul, 120-080, Republic of Korea.
email: sejin.youn@gmail.com

7/31/10
punt on Korean for now - can get it to be visible in the .properties file
	but can't get the chars to show in the menus.
move the .properties file into a folder "Future"
comment out the line in VGLII for the Korean menu item.

several people don't like Circular Dominance
	so add three parameters to the .pr2 files: 
	come into play if 3 alleles
		Gene1_CircDom
		Gene2_CircDom
		Gene3_CircDom - 
			0 = no circ dom; all hierarch dom
			0.5 = 50/50 circ/hierarch dom <DEFAULT>
			1 = all circ dom; no hierarch dom

revised params are now:
- first, set the overall sex determining mechanism
   even if not sex-linked
	* ZZ_ZW - chance of ZZ/ZW sex linkage

- then some overall issues
	* BeginnerMode - True or False - allows users to see the genetic model
					by clicking on button in field pop cage
					and see genotypes of organisms (tool tip text)
	
	* MinOffspring - minimum number produced in each cage (capped at 100)
					- actual number is randomly distributed between these
	* MaxOffspring - maximum number produced in cage (capped at 100)

- then the first gene - there must be at least one
	* Gene1_SexLinked - chance that it'll be sex-linked
							(if not, it'll be autosomal)
	* Gene1_3Alleles - 	chance it's 3-alleles
							(if not, it'll be 2 allele)
	* Gene1_IncDom  - 	chance it's inc dom
							(if not and 2 allele - simple dom)
							(if not and 3 allele then adjustable
								chance of hierarch/circ dom - see CircDom)
	* Gene1_CircDom - chance (if it's 3 allele and not inc dom) it's circ dom
							0 = no circ dom; all hierarch dom
							0.5 = 50/50 circ/hierarch dom <DEFAULT>
							1 = all circ dom; no hierarch dom
								
- second gene - may or may not be there
	* Gene2_Present -	chance it's present
							(if not, it's a 1 gene model)
	* Gene2_SameChrAsGene1	- chance gene2 and 1 are on same chromo
								(if not, they are on different ones)
								(that is, sex vs auto)
	* Gene2_MinRfToGene1	- range of possible recombination freqs
	* Gene2_MaxRfToGene1		(between gene 1 and gene 2 if on same chromo)
	
	* Gene2_3Alleles		- same as above
	* Gene2_IncDom
	* Gene2_CircDom
	
- third and final gene - may or may not be there
	* Gene3_Present	- 	chance it's present
							(if not, it's a 2 gene model)
	* Gene3_SameChrAsGene1	- same as above
	* Gene3_MinRfToGene1
	* Gene3_MaxRfToGene1
	* Gene3_3Alleles
	* Gene3_IncDom
	* Gene3_CircDom

- make new problem files
  only Level07 and Level08 have any circ dom
  make Level07-nc & -nc-p versions (Gene1_CircDom = 0) so now:

also add a 
- Level05-1.pr2 = One Gene (Autosomal, ZZ/ZW, or XX/XY Sex-Linked); 2 Alleles, Simple Dominance
p versions have practice mode

- Level01.pr2 = One Autosomal Gene; 2 Alleles, Simple Dominance 
- Level02.pr2 = One Autosomal Gene; 2 Alleles, Incomplete Dominance
- Level03.pr2 = One XX/XY Sex-linked Gene; 2 Alleles, Simple Dominance
- Level04.pr2 = One XX/XY Sex-linked Gene; 2 Alleles, Incomplete Dominance
- Level05.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 2 Alleles, Simple Dominance
- Level05-1.pr2 = One Gene (Autosomal, XX/XY or ZZ/Zw Sex-linked); 2 Alleles, Simple Dominance
- Level06.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 2 Alleles, Incomplete Dominance
- Level07.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 3 Alleles 
								(Incomplete, Hierarchical, or Circular dominance)
- Level07-nc.pr2 = One Gene (Autosomal or XX/XY Sex-Linked); 3 Alleles 
								(Incomplete or Hierarchical dominance)
- Level08.pr2 = One Gene (Autosomal, XX/XY Sex-Linked, ZZ/ZW Sex-Linked);
				(2 or 3 Alleles); (Incomplete, Hierarchical, or Circular dominance)
- Level08-nc.pr2 = One Gene (Autosomal, XX/XY Sex-Linked, ZZ/ZW Sex-Linked);
				(2 or 3 Alleles); (Incomplete or Hierarchical dominance)
- Level09.pr2 = Two Unlinked Autosomal Genes; 2 Alleles each; Simple Dominance
- Level10.pr2 = Two Linked Autosomal Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple Dominance
- Level11.pr2 = Two Genes, either XX/XY Sex-Linked or Autosomal; 2 Alleles each; 
					Simple dominance

- Level12.pr2 = Three Linked Autosomal Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple dominance
- Level13.pr2 = Three Sex-Linked Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple dominance

also needed to fix one of the problem files
-Level07.pr2 did not allow for sex-linkage

made it version 2.1.0
made mac and pc versions and posted

8/5/10
by request, some wanted the option to have all the field strains pure-breeding
(especially for the 3-factor crosses)
so make new parameter:
	FieldPopTrueBreeding true/false
	default is false

8/10/10
made new problems:
- Level12TB.pr2 = Three Linked Autosomal Genes (0.1 < rf < 0.3); 2 Alleles each;
					Simple dominance; Field population true breeding
- Level12TBp.pr2

- Level10-1.pr2 = Two Unlinked or Linked Autosomal Genes (0.1 < rf < 0.5); 2 Alleles each;
					Simple Dominance
- Level10-1p.pr2
					
call it version 2.1.1

10/28/10
revisions:
- have it save a CageUI's position and visibility when work saved
 -- works!

- have it save the time when a cage was created (for logging purposes)
	in the xml, there is now an Attribute called "Created" which is a string like Thu Oct 28 15:53:58 EDT 2010
experimenatlly tagged it as version 2.1.2

11/11/10
started working on epistasis
created PhenotypeProcessor to deal with phenotypic interactions, etc.
all phenotypes managed in PhenotypeProcessor
route needed stuff thru there
	in GeneticModel
		- getPhenotype
		- getRandomOrganism
		- getNumberOfCharacters
	in Organism
		- getToolTipText
set it up to pass it all through at first..

specifying complementation or epistasis in the .pr2 file works like this:
- if there's going to be compl or epi, it's a special case
	- alternatives are:
		- (no interaction) = one 2-allele simple dominance model
		- (interaction) = two 2-allele simple dominance models that interact
			(they'll be genes 1 and 2)
		*thus, the only relevant specs are sex-linkage chance for the genes 
- so the params are:
	PhenotypeInteraction <float> = chance there'll be epistasis or complementation
	Epistasis <float> = chance, if there's an interaction, that it'll be epistasis
						otherwise, complementation
- if the chance of epistasis or compl > 0, then the alternatives are
	for complementation: one gene 2 allele simple dom
	for epistasis: one gene 3 allele hierarchical dom

the gene models are going to need an index so I can find them

11/12/10
working on it
for .pr2 file, need some more info
Complementation =
<?xml version="1.0" encoding="UTF-8"?>
<root>
	<BeginnerMode>True</BeginnerMode>
	<ZZ_ZW>0.0</ZZ_ZW>
	<Gene2_SameChrAsGene1>1.0</Gene2_SameChrAsGene1>
	<Gene2_MinRfToGene1>0.5</Gene2_MinRfToGene1>
	<Gene2_MaxRfToGene1>0.5</Gene2_MaxRfToGene1>
	<PhenotypeInteraction>1.0</PhenotypeInteraction>
</root>

seems to be working!
check #s - 20 crosses of AaBb x AaBb with epistasis (526 offspring)
expect 9:4:3 = 295.875:131.5:98.625
got 302:140:84
on-line chisq calc gives p = .25 so OK!
http://www.people.ku.edu/~preacher/chisq/chisq.htm

now need to:
1) be sure third gene works OK
2) get model to display properly in practice mode
3) get saving and loading to work

Problem with (1) - not enough traits
	so make the interacting geneModels special - they use A, a, B, and b as their phenotypes
	InteractingGeneModel

setting up proper printouts
terms that need to be translated:
Non-Functional
Functional
Epistasis
Complementation

fixed (1) and (2)

got (3) going

11/16/10
seems to be working; do some tests
- be sure that you can run, save, and load:
	- compl models OK
	- 2-allele simple dom models from compl.pr2 OK
	- epi models OK
	- 3-allele hierarch models from epi.pr2 OK
	- regular level1 models OK
	- regular 3-gene models OK
	- be sure you can load an old VGLII model FAIL 
		(needed to deal with contingency of missing Xpos, Ypos, & visibility)
		now OK

** epistasis & complementation are now AOK!!!

11/26/10
UI changes (thanks to Cameron Betts)
- put parent info at top of panel; added titled & colored border
- labeled field pop as such; added titled & colored border
- put phenotypes at left most column(s); added titled & colored border

12/7/10
started working on model building widget

1/11/11
fixed bug in model building widget's detecting if linkage is appropriate
tested with all current problem files & it bhaves properly
(it includes a linkage pane with models 10, 10-1, 12, 12TB, 13 only; 
1, 2, 3, 4, 5, 5-1, 6, 6, 7NC, 8, 8NC, 9, 11, 11-1 do not)

2/6/11
some improvements from sophie
- add to cage manager an "invert selection" button
- made super cross

2/17/11
got Model Builder working and saving
version 3.0.0
sent out for translation from Sophie

2/21/11
rearranging problems
start by making NewProblems folder
	- make folder Classic for equivalents of VGL levels
		(if there's an equivalent file, just rename it)
		in Classic/
			OLD FILE	EQUIVALENT
			Level01.prb	Level01p.pr2
			Level02.prb	Level01.pr2
			Level03.prb	Level03p.pr2
			Level04.prb	Level03.pr2
			Level05.prb none - edit Level06p.pr2
			Level06.prb	none - edit Level06.pr2
			Level07.prb	none - edit Level08p.pr2
			Level08.prb	none - edit Level08.pr2
			Level09.prb Level08p.prb
			Level10.prb Level08.pr2

	- make folder OneGene for one gene files
			(also do the corresponding p versions)
			OLD NAME		NEW NAME
			Level01.pr2		OneGene01.pr2
			Level02.pr2		OneGene02.pr2
			Level03.pr2		OneGene03.pr2
			Level04.pr2		OneGene04.pr2
			Level05.pr2		OneGene05.pr2
			Level05-1.pr2	OneGene06.pr2
			Level06.pr2		OneGene07.pr2
			Level07NC.pr2	OneGene08.pr2
			Level07.pr2		OneGene09.pr2
			Level08NC.pr2	OneGene10.pr2
			Level08.pr2		OneGene11.pr2

Brian-Whites-MacBook-Air:Problems brian$ cp Level01.pr2 ../NewProblems/OneGene/OneGene01.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level01p.pr2 ../NewProblems/OneGene/OneGene01p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level02.pr2 ../NewProblems/OneGene/OneGene02.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level02p.pr2 ../NewProblems/OneGene/OneGene02p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level03.pr2 ../NewProblems/OneGene/OneGene03.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level03p.pr2 ../NewProblems/OneGene/OneGene03p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level04.pr2 ../NewProblems/OneGene/OneGene04.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level04p.pr2 ../NewProblems/OneGene/OneGene04p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level05.pr2 ../NewProblems/OneGene/OneGene05.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level05p.pr2 ../NewProblems/OneGene/OneGene05p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level05-1.pr2 ../NewProblems/OneGene/OneGene06.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level05-1p.pr2 ../NewProblems/OneGene/OneGene06p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level06.pr2 ../NewProblems/OneGene/OneGene07.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level06p.pr2 ../NewProblems/OneGene/OneGene07p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level07NC.pr2 ../NewProblems/OneGene/OneGene08.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level07NCp.pr2 ../NewProblems/OneGene/OneGene08p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level07.pr2 ../NewProblems/OneGene/OneGene09.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level07p.pr2 ../NewProblems/OneGene/OneGene09p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level08NC.pr2 ../NewProblems/OneGene/OneGene10.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level08NCp.pr2 ../NewProblems/OneGene/OneGene10p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level08.pr2 ../NewProblems/OneGene/OneGene11.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level08p.pr2 ../NewProblems/OneGene/OneGene11p.pr2

2/26/11
did the two gene problems
	- make folder TwoGenes for two gene files
			(also do the corresponding p versions)
			OLD NAME		NEW NAME
			Level09.pr2		TwoGenes01.pr2
			Level10.pr2		TwoGenes02.pr2
			Level10-1.pr2	TwoGenes03.pr2
			Level11.pr2		TwoGenes04.pr2
			Level11-1.pr2	TwoGenes05.pr2

Brian-Whites-MacBook-Air:Problems brian$ cp Level09.pr2 ../NewProblems/TwoGenes/TwoGenes01.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level09p.pr2 ../NewProblems/TwoGenes/TwoGenes01p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level10.pr2 ../NewProblems/TwoGenes/TwoGenes02.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level10p.pr2 ../NewProblems/TwoGenes/TwoGenes02p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level10-1.pr2 ../NewProblems/TwoGenes/TwoGenes03.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level10-1p.pr2 ../NewProblems/TwoGenes/TwoGenes03p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level11.pr2 ../NewProblems/TwoGenes/TwoGenes04.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level11p.pr2 ../NewProblems/TwoGenes/TwoGenes04p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level11-1.pr2 ../NewProblems/TwoGenes/TwoGenes05.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level11-1p.pr2 ../NewProblems/TwoGenes/TwoGenes05p.pr2

	- make folder ThreeGenes for three gene files
			(also do the corresponding p versions)
			OLD NAME		NEW NAME
			Level12TB.pr2	ThreeGenes01.pr2
			Level12.pr2		ThreeGenes02.pr2
			Level13.pr2		ThreeGenes03.pr2

Brian-Whites-MacBook-Air:Problems brian$ cp Level12TB.pr2 ../NewProblems/ThreeGenes/ThreeGenes01.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level12TBp.pr2 ../NewProblems/ThreeGenes/ThreeGenes01p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level12.pr2 ../NewProblems/ThreeGenes/ThreeGenes02.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level12p.pr2 ../NewProblems/ThreeGenes/ThreeGenes02p.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level13.pr2 ../NewProblems/ThreeGenes/ThreeGenes03.pr2
Brian-Whites-MacBook-Air:Problems brian$ cp Level13p.pr2 ../NewProblems/ThreeGenes/ThreeGenes03p.pr2

	- make folder InteractingGenes for interacting gene files
			(also do the corresponding p versions - need to make non-p versions)
			OLD NAME		NEW NAME
			comp.pr2		Complementation01.pr2
			epi.pr2			Epistasis01.pr2

renamed as Interactions01 and 02, respectively

had a REALLY hard time moving the problem files
had to
	- delete the problem file folders
	- commit the change
	- make a new problem file folder
	- commit the change
	- drag 1 set of prob files to folder
	- commit the change
	- make a folder in problems and move the files in
	- commit the change
	(do the last steps for each folder of problems)!
		
for internationalization and grading, need to make ModelBuilder save in english and only display 
in the local language..

make reverseTranslate(String) in Messages - use this in save only
	(so it processes in local language but saves in english)
- reverse translate fails on things like "Body Shape" - it takes 2 translations to do this
	("Body" and "Shape")
		also, what about 2 english words with the same french translation..
- will have to use indices...

2/27/11
working on grader

3/1/11
working on grader, got it to load work
shift-click shows all the cages, etc

3/2/11
cleaned up VGLII.java
	moved out some big methods that could be made static
started graying out grader options in their answer when it wasn't a choice

3/3/11
finished graying out no choice options
started making GeneticModel output html for the grader

3/23/11
getting grader to show prob file name and linkage

problem:
with epi and comp
the model builder shows inc dom as the alternative
but the problem file has others
fix:
	alternative for compl = 2 allele simple dom
	alternative for epi = 2 allele inc dom
fix in GeneticModelFactory, TwoAllelePanel, website

3/24/11
working on cage scoring

3/25/11
ditto
be generous, all sex-link cagesalso give dominance
(actually, you need to know if XX/XY or ZZ/ZW to get full dominance from a 
sex-linkage result, but ok for now)

tested with 
	one gene auto simple
	one gene auto inc
	one gene sex link simple
	two genes sex/auto
	three genes auto

3/26/11
working on security - started by moving encrypt/decrypt of work files to 
	EncryptionTools static methods


4/7/11
changed decryption of grader.key to RSA
made VGL/keys folder and put private.key there (ok; it's used for decryption)
now AOK

4/11/11
problem: loading a lot of files to grade runs out of memory
fix:
	- don't have option to see cages of a problem
	- do all scoring for each file, save html for grader and clean up completely
	
got it to work, but it pops up lots of useless ModelBuilderUIs...

fixed that by making the MBUI a JPanel that only appears if it's built into a dialog
(for grading, it's never shown)

4/16/11
starting to work on SaveForGrading

4/17/11
fixed some bugs
- changed text in ModelBuilderUI to 'for allele interaction type'
- when there was trouble making XML for saving work, it had been quietly dying
	because an exception was being caught but no stack trace
		(made debugging hard)
	- fixed in VGLII.saveProblem()
- if you try to save without showing the model builder, there's an error
	"component must be showing on the screen to determine its location"
	needed to use isShowing() not isVisible() in mbui's save
- nix the "change since last save" feature - always save
	this is because it's very hard to tell if the MBUI has changed
	so just save all the time (remove that boolean from VGL)
- fixed KeyFileChecker so that the password field automaticaslly gets 
	the focus
- a little refactoring to make it easier to use RSA encryption in save for grading
	GeneticModelFactory.readModelFromFile(file)
		split into readfromXML which is called by read from XOREncry file or readRSA
- set up to require:
	student.key for "Save For Grading"
	grader.key AND instructor.key for "Grade Students Work"

Problem, can't rsa encrypt blocks larger than 117 bytes
	need to break up (or punt); see: 
	http://www.aviransplace.com/2004/10/12/using-rsa-encryption-with-java/3/
	http://www.coderanch.com/t/481259/Streams/java/read-text-file-buffer-at

4/19/11
got SaveForGrading working
added some more French & spanish text
version 3.1.0

4/26/11
added dual progress bar for loading grading files
  ones with SUperCross take a LONG time to load

4/27/11
made grader loading progress dialog look better
added a little spanish & french translation

5/3/11
opening files runs very SLOWLY
do profiling:
java -Xrunhprof:cpu=samples,file=log.txt -jar VGLII.jar 

look in log.txt
CPU SAMPLES BEGIN (total = 3105) Mon May  2 20:57:49 2011
rank   self  accum   count trace method
   1 29.15% 29.15%     905 300723 java.math.BigInteger.oddModPow
   2 25.22% 54.36%     783 301747 java.math.BigInteger.oddModPow
   3  6.51% 60.87%     202 300727 java.math.BigInteger.montReduce
   4  5.28% 66.15%     164 300728 java.math.BigInteger.oddModPow
   5  5.15% 71.30%     160 300724 java.math.BigInteger.oddModPow

TRACE 300723:
        java.math.BigInteger.oddModPow(BigInteger.java:1822)
        java.math.BigInteger.modPow(BigInteger.java:1571)
        sun.security.rsa.RSACore.crypt(RSACore.java:96)
        sun.security.rsa.RSACore.rsa(RSACore.java:86)
TRACE 301747:
        java.math.BigInteger.oddModPow(BigInteger.java:1821)
        java.math.BigInteger.modPow(BigInteger.java:1571)
        sun.security.rsa.RSACore.crypt(RSACore.java:96)
        sun.security.rsa.RSACore.rsa(RSACore.java:86)
TRACE 300727:
        java.math.BigInteger.montReduce(BigInteger.java:1861)
        java.math.BigInteger.oddModPow(BigInteger.java:1822)
        java.math.BigInteger.modPow(BigInteger.java:1571)
        sun.security.rsa.RSACore.crypt(RSACore.java:96)

so its the decryption that takes so long
to fix, reduce the amount to be decrypted
since not showing the cages anyway, just save the html for the grader!

much faster...

did some testing
(of new .gr2 mode)
ran jar file by double-clicking
under mac os
	- took 10 .wr2 files from Patty's "VGLBonus" folder
		opened in VGLII, saved for grading using Patty's new tokens
		saved into "for grading"/
	- all 10 opened in "Grade Students' Work" 
under win xp
	- took 2 more of those .wr2 files
		opened and saved as above
	- all 12 opened in "Grade Students' Work"
back to mac os
	- all 12 opened AOK

therefore, can save for grading in either mac or win and open with either AOK
** good!

fixed bug - closing work left blank ModelBuilder
	need to dispose() of the JDialog

5/4/11
tested with 108 .gr2 files (Patty had reported that, with old, uncompressed .gr2's,
it hung with more than 20

made them by using os x to duplicate the 12 ones I made
then in terminal
for i in *copy; do mv "$i" "${i/.gr2 copy/}"_new.gr2; done

worked AOK with 108 files.

5/5/11
made mac, linux, and pc versions & posted on web

5/18/11
Sophie found a bug in SuperCross - some layout issues in CageUI
	fixed
	version 3.1.2

5/24/11
put back changeSinceLast save and set it up to work with ModelBuilder
still version 3.1.2

5/25/11
made it so that: when you open a work file, VGL remembers the name
	when saves happen - so you save to the same file

made mac, pc, and linux versions and posted

9/23/11
some bug fixes:

1) some had noticed "poison" .wr2 files
	they would partially open - not all the cages
		and then you would not be able to cross, etc
		(it was as though it had never enabled the menus after loading the problem)
	it was when they'd crossed individuals from a super cross - that made an un-openable cage
	beacuse CageUI.getOrganismUIFor(int id) counts up to the masOrgsPerRow not absoluteMaxOrgsPerRow
	fixed that method
now AOK

2) when saving for grading, the dialog still calls them "work files" not "grading files"
	fixed VGL and messages files

- still need french and spanish for "Files for grading"

9/26/11
- double-checked to be sure no more maxOrgsPerRow in CageUI - it's OK
- fixed the translations of "Files for Grading"

9/28/11
made it warn you if you try to save a file with poison characters in the name
version 3.1.4

12/13/11
posted to web after testing

2/5/12
(before this, added Korean menu stuff - still need help's index.html)
added recombination freq to model builder

made CageScorer a real (not static) class to facilitate analysis of linkage

2/6/12
7) Bug: if they rename a .wr2 file as .gr2 it messes up the grader
	need to detect and put "unreadable file" in grader

the error looks like this:
     [java] java.lang.IllegalArgumentException: Length of Base64 encoded input string is not a multiple of 4.
     [java] 	at VGL.Base64Coder.decode(Base64Coder.java:195)
     [java] 	at VGL.Base64Coder.decode(Base64Coder.java:183)
     [java] 	at VGL.Base64Coder.decode(Base64Coder.java:173)
     [java] 	at VGL.EncryptionTools.readRSAEncrypted(EncryptionTools.java:272)
     [java] 	at Grader.WorkFileLoader.run(WorkFileLoader.java:53)
     [java] 	at java.lang.Thread.run(Thread.java:680)
     [java] org.jdom.input.JDOMParseException: Error on line 1: Premature end of file.
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:468)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:851)
     [java] 	at VGL.EncryptionTools.readRSAEncrypted(EncryptionTools.java:286)
     [java] 	at Grader.WorkFileLoader.run(WorkFileLoader.java:53)
     [java] 	at java.lang.Thread.run(Thread.java:680)
     [java] Caused by: org.xml.sax.SAXParseException: Premature end of file.
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:174)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:388)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1414)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:1059)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:140)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)
     [java] 	at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:453)
     [java] 	... 4 more
     [java] Caused by: org.xml.sax.SAXParseException: Premature end of file.
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:174)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:388)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1414)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:1059)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:140)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)
     [java] 	at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:453)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:851)
     [java] 	at VGL.EncryptionTools.readRSAEncrypted(EncryptionTools.java:286)
     [java] 	at Grader.WorkFileLoader.run(WorkFileLoader.java:53)
     [java] 	at java.lang.Thread.run(Thread.java:680)
     [java] Caused by: org.xml.sax.SAXParseException: Premature end of file.
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.createSAXParseException(ErrorHandlerWrapper.java:195)
     [java] 	at com.sun.org.apache.xerces.internal.util.ErrorHandlerWrapper.fatalError(ErrorHandlerWrapper.java:174)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLErrorReporter.reportError(XMLErrorReporter.java:388)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLScanner.reportFatalError(XMLScanner.java:1414)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl$PrologDriver.next(XMLDocumentScannerImpl.java:1059)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentScannerImpl.next(XMLDocumentScannerImpl.java:648)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLNSDocumentScannerImpl.next(XMLNSDocumentScannerImpl.java:140)
     [java] 	at com.sun.org.apache.xerces.internal.impl.XMLDocumentFragmentScannerImpl.scanDocument(XMLDocumentFragmentScannerImpl.java:511)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:808)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.parse(XML11Configuration.java:737)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.XMLParser.parse(XMLParser.java:119)
     [java] 	at com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse(AbstractSAXParser.java:1205)
     [java] 	at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.parse(SAXParserImpl.java:522)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:453)
     [java] 	at org.jdom.input.SAXBuilder.build(SAXBuilder.java:851)
     [java] 	at VGL.EncryptionTools.readRSAEncrypted(EncryptionTools.java:286)
     [java] 	at Grader.WorkFileLoader.run(WorkFileLoader.java:53)
     [java] 	at java.lang.Thread.run(Thread.java:680)
     [java] Exception in thread "Thread-4" java.lang.NullPointerException
     [java] 	at Grader.WorkFileLoader.run(WorkFileLoader.java:54)
     [java] 	at java.lang.Thread.run(Thread.java:680)

so, maybe detect it in EncryptionTools and return null
then detect that and report that the file was unreadable rather than dying
in the grader, make the entry "Unreadable file; probably a .wr2 renamed to .gr2"

fixed by making EncryptionTools' Document readRSAEncrypted(File inFile, PrivateKey privKey)
return null if unreadable
then fixed GeneticModelFactory's GeneticModelAndCageSet readModelFromRSAFile(File workFile, PrivateKey gradingKey)
return null if it gets a null document from readRSAEncrypted
then WorkFileLoader inserts an appropriate message for the grader if it gets null

tested OK

back to linkage
adding a choice for evidentiary cage

bug - when linkage panel made, there's no mbui - it's null...


4/11/12
added "sex" checkbox to Summary Chart in preparation for chi-squared calculation

added test to LinkagePanel: if mbui == null, just say there are no cages in the list (see above bug)

4/13/12
trying to get org.apache.commons jar file into project
got commons-math3-3.0-bin.tar.gz from http://commons.apache.org/math/download_math.cgi
unzipped and un-tarred
put whole folder under VGLII and saved to SVN

followed instructions from
http://www.java-forums.org/new-java/10601-how-make-apache-commons-stringutils-etc-work-eclipse.html
In eclipse:
A Put the library in the java build path

Window -> Preferences: Java - Build path - User Libraries push the "New..." button, 
	and in the "User library name:" enter 'appache-commons-lang'.
Click to select "appache-commons-lang" in the "Defined user libraries" list 
	and then click on the "Add JARs..." button and browse for commons-lang-2.4.jar 
	(in the folder you've saved earlier) and select it.
Now in the "Defined user libraries", under commons-lang-2.4.jar you have to have
	"Source attachment" and "Javadoc location" ; for each of them, select it, then 
	push "Edit..." , then "External file" and browse for the corresponding jar 
	(/commons-lang-2.4-sources.jar and commons-lang-2.4-sources.jar

B. In your project add this user library
In the Package Explorer right-click on the project name, go to Properties, and 
	select the Libraries tab; click the "Add Library..." button, from the list 
	select "User library" , "Next", mark [x] appache-commons-lang, and click "Finish"

will use ChiSquareTest.chiSquareTest()

4/17/12
needed to add zipfilest src = the math.jar to make apache.commons work

need translations for:
VGLII.Observed=Observed
VGLII.Expected=Expected
VGLII.Chi-sqZeroTitle=Invalid Expected Value
VGLII.Chi-sqZeroText=All Expected values must be > 0.

also help file info

4/19/12
fixed help in english & added tool tip text
will also need translations for tool tip text
VGLII.ExpectedLine1=Enter <u>whole number</u> values for 
VGLII.ExpectedLine2=expected quantities of offspring.
VGLII.ExpectedLine3=\u03C7<sup>2</sup> is calculated when all values entered.

5/25/12
had to fix the apache math stuff
did EXACTLY as above and it worked

got summary chart to print when you print work
korean help html now working
	(had him start with blank text file, save as utf-8, paste in, save and
		e-mail me a .zip file of the html)
added some frehcn text for chi-square

5/29/12
working on misc stuff
- fixed cage lists in linkage panel
- updated the saving, loading, printing, etc of linkage panel
- for now, for evidence of linkage, just give parent genotypes

5/30/12
grader bug - in sex-linkage it's not counting things properly
	it doesn't see the second line of offspring in cage 6 in simple.wr2

6/1/12
working on grader bug
	was looking at phenotype's trait = Eye:Color:Gray
		but want character = Eye:Color and match both Gray and Green (for example)
	also, if any phenotype (Eye:Color:Gray OR Eye:Color:Green) shows a sex-mismatch then sex-linked
		had been doing it only if Eye:Color as a whole showed sex-mismatch
fixed both - test extensively - be sure that: 
	- sex-linkage evidence in any phenotype line is detected <OK>
	- if absent, it's flagged OK <OK>
	- be sure inc dom is also OK <OK>
	- test in multi-gene probs <OK>

also need to test the dominance stuff (didn't change it but just to be sure)
	- detected in any row of display <OK>
	- detected all 3 types <OK>
	- detected in multi-gene probs <OK>

worked on compl & epi evidence detection
	- it should be the same as for the dominance (missing or new phenos)
		so try just using the existing scoring

6/18/12
finished adding Korean stuff
version 3.2.0
made mac, pc, linux versions and posted

6/19/12
UGH - korean html looks bad in korea (but OK in us)
may be because I edited and saved the file 
(best to never touch it)
luckily have a backup in the version I showed to Se-Jin
un-jared it and replaced Help_kr/index.html
  saved a copy in Future/
try in Korea
also updated version to 3.2.1
  and the info file to thank him properly
 
8/24/12
need to sign the app for mac osx mountain lion
export CODESIGN_ALLOCATE="/Applications/Xcode.app/Contents/Developer/usr/bin/codesign_allocate"
codesign -s "Developer ID Application: Brian White" -vf VGLII-3.2.0.app/

12/15/12
working on stuff for edX and lingering items in the to-do list

1) automatic scoring - comparing model builder and right answer


12/16/12
in AutoGrader
	need to fix 
		- linkage checking not right
			need to calculate expected rf for gene 1 - gene 3 - how?
		- when no interaction type selected, the details are "CORRECT"!	
			probably, if interactionType is wrong, can't get details

12/17/12
checking on linkage - if map is A B C and you know rf(AB) and rf(BC)
	can you calculate rf(AC)?
		yes - use map function (Kosambi) rf = 0.5 * tanh(2*(r1 + r2))
tested with 2 problems with order ABC (filed .wr2's with edX stuff)
	1) "3-factor 1.wr2"
		given rf(AB) = 0.20; rf(BC) = 0.23; predict rf(AC) = 0.5 tanh(0.20 + 0.23) = 0.35
		do a super cross with 2000 offspring and measure:
			rf(AB) = 0.22; rf(BC) = 0.23; rf(AC) = 0.34 - all very close
	2) "3-factor 2.wr2"
		given rf(AB) = 0.15; rf(BC) = 0.29; predict rf(AC) = 0.5 tanh(0.20 + 0.23) = 0.34
		do a super cross with 2000 offspring and measure:
			rf(AB) = 0.14; rf(BC) = 0.28; rf(AC) = 0.34 - all very close
conclusion: use the tanh to find the expected freq

set up; now working

test with 2-factor cross - AOK

fixed the interactionType/details issue above

12/18/12

BE SURE TO TEST WITH EPI & COMP (did this on 1/8/13)

1/8/13
setting up to save to edX server
got sample-post.py from Victor Schnayder to show how to save to server

- tested for EPI and comp - OK
- tested if no model entered, it's all wrong
- tested linkage evidence cage OK
- test a weird model
	a non-sex-linked model with proper justification OK
	a sex-liked one - makes error!
		"sex-linked causes error.wr2"
		in checking if cage can show linkage, it looks for recessive allele
			but, if sex-linked and you look for an allele on a null sex-chromo
				you get null
			what to do?
			in Organism - getGenotypeForGene(int i) 
				need to deal properly with null sex chromosomes
			in AutoGrader - ditto
		still a problem - in this prob, if you check cage 3 there's an error
	will need to check sex-linkage evidence carefully
	- seems OK

1/19/13
problem with auto grader and inc dom
	it says it's wrong if they get the order of the homozygotes wrong
		and this should be OK
	that is, for inc dom:
		2-allele:
			t1 and t2 can be exchanged
		3-allele: 
			only the circular permutations of the het's are possible
			normal slot		alternatives
				1			1	3	2
				2			2	1	3
				3			3	2	1
				4			4	6	5
				5			5	4	6
				6			6	5	4
			
	also, the circular permutations of circular dominance <sigh>
		normal slot		alternatives
		  	1			1	3	2
		  	2			2	1	3
		  	3			3	2	1
need to code all of these...

did 'em and tested 'em

all seems to be working for the edX problems!

1/23/13
working on server connection
need both the CookieManager and the "X-CSRFToken" things to get a proper connection
if login works, you get this single line back from the server
{"success": true}

1/28/13
settting up command line interface
GOALS:
	- pass as command-line params
		- edX server stuff
			(if not complete, make object null and error then no save to server)
		- all params found in .pr2 file
			(use config file processor if you can)
		- for test, make config print itself to debug

re-factored GeneticModelFactory's xml parser and tested OK.
command line params will be in this format:
-BeginnerMode=false
	that is:
		separated by whitespace
		start with "-"
		name and value separated by "="
build into genetic model factory

need to be sure save to server disabled unless
	- not practice mode (don't even show it)
	- all edX params AOK
		do this by updating params
			when you try to get the edXparams object, it checks for completeness or returns null

1/29/13
command line is working; need to consider various modes

1) Standard = start with blank screen and open from there (the way it's always been)
	- launch with no params
	- "Save to edX" - absent
	- "new problem" - present

2) Launch with work or problem file = opens with that problem started
	- launch with 1 param = filename.pr2 or .wr2
	- "save to edX" - absent
	- "new problem" - grayed out

3) Launch from edX with no file (so they can look at saved work)
	- launch with 1 param = -edXMode
	- "save to edX" - present
	- "new problem" - absent (and disable key command)

4) Launch from edX with lots of params to open with new problem file specified by params
	- launch with > 1 param 
	- "save to edX" - present
	- "new problem" - absent (and disable key command)

BE SURE:
- when you save an edX started problem, you save the edX params so you can save to edX after re-opening

1/30/13
trying java web start
get error:
	access denied ("java.util.PropertyPermission" "user.home" "read")
need to be able to access the user's home dir if the save their work

try signing the jar
no error message, but the file's mod time was not changed and that didn't help

works if you comment out the stuff at the start where it finds the user's home dir
	(but you need that to save work)
try following this http://weblogs.java.net/blog/kirillcool/archive/2005/05/signing_jars_fo.html
in my home dir on home mac:
	keytool -genkey -keystore testing.keys -alias VGLKey -validity 365
		Enter keystore password:  
		Re-enter new password: 
		What is your first and last name?
		  [Unknown]:  Brian White
		What is the name of your organizational unit?
		  [Unknown]:  UMB Biology
		What is the name of your organization?
		  [Unknown]:  UMB
		What is the name of your City or Locality?
		  [Unknown]:  Boston
		What is the name of your State or Province?
		  [Unknown]:  MA
		What is the two-letter country code for this unit?
		  [Unknown]:  US
		Is CN=Brian White, OU=UMB Biology, O=UMB, L=Boston, ST=MA, C=US correct?
		  [no]:  yes

		Enter key password for <VGLKey>
			(RETURN if same as keystore password):  
(used usual pswd)
jarsigner -keystore testing.keys -storepass top33dog Documents/workspace/VGLII/VGLII.jar VGLKey

added to jnlp
  <offline-allowed/>
   <security>
      <all-permissions/>
   </security>
error: Found unsigned entry in resource http://www.securebio.umb.edu/edX/VGLII.jar
but 
jarsigner -verify Documents/workspace/VGLII/VGLII.jar 
jar verified.

found on web: http://www.coderanch.com/t/200684/JNLP-Web-Start/java/jdk-unsigned-entry-resource
go into system prefs -> java prefs -> clear all temporary internet files
AOK!!
put testing.keys into project

need to clear temp files each time you send up a new version

needed to fix layout of pswd dialog
got SpringUtilities.java from http://docs.oracle.com/javase/tutorial/uiswing/examples/layout/SpringGridProject/src/layout/SpringUtilities.java

2/4/13
there's a problem with Korean - the grading fails (probably because they use those strange character strings)
need to completely delete Korean - so, in Korea, it won't give an error
	- remove Future/messages_k-_KR.properties (it's an old version)
	- move VGL/messages_k-_KR.properties to Future/
	- edit VGLII.java to remove Korean menus

2/14/13
for edX - set it to remember passwords once entered

also added button and icon to tool bar

for UI testing, use this command
java -jar VGLII.jar -edXCookieURL=x -edXLoginURL=y -edXSubmissionURL=z -edXLocation=a

for saving to server, use this one
java -jar VGLII.jar -edXCookieURL=https://www.edx.org -edXLoginURL=https://www.edx.org/login -edXSubmissionURL=https://www.edx.org/courses/MITx/6.002x/2012_Fall/modx/i4x://MITx/6.002x/problem/Sample_Numeric_Problem/problem_check -edXLocation=input_i4x://MITx/6.002x/problem/Sample_Numeric_Problem_2_1 -BeginnerMode=False -ZZ_ZW=0.0 -Gene1_SexLinked=0.0 

have it saving password - it re-logs in each time

version 3.3.0

2/16/13
many changes for edX
- need not to say "dominant allele" but "dominant phenotype"; many places to fix this:
	(don't bother with translation - just leave it unchanged in other languages)
	- help
	- modelBuilder
- if login fails, but not because of cancel, give them another chance
	(did this by refactoring the edX server communication out of VGLII and into EdXServerUtils first)
	
2/17/13
make "swiss army knife" edX version
if started with params & server OK
	- start BLANK
	- new prob enabled
		pops up dialog to choose practice/not mode
	- open work enabled
do in eventHandler - differnent new problem events (NewProbFromFile, NewProbFromArgs)

2/18/13
need to test these cases:
- save a practice mode file - be sure it opens in practice mode
	need to fix this - now fixed
- start a problem under A, save it, open under B, submit - be sure it submits to A
	need to check this when it's on the web - OK

put up a version "3.3.0 2012-02-18 13:20"

had broken the remember password on successful login thing <sigh>
new version "3.3.0 2012-02-18 16:30"
sent to edX

2/24/13
problems with edx communication
need to make version that reports error text.
version "3.3.0 2012-02-24 15:00"

tested pull request - added this text from text editor
	see if it appears in eclipse - NG so far
	
2/25/13
eclipse working with github
submitted xml was too long for edx
simplified to just grade info
version "3.3.1 2012-02-25 22:00"

2/16/14
added 4 new Interactions files to "Future"
Interactions03 - Interactions01 with 100% chance of complementation
Interactions03p - Interactions01p with 100% chance of complementation
Interactions04 - Interactions02 with 100% chance of epistasis
Interactions04p - Interactions02p with 100% chance of epistasis

4/22/14
fixing some bugs/issues
16) Allow non integer expected values in chi-squared boxes (Sophie J)
	- work in SummaryChartUI

7) change label in ModelBuilder for Linkage from ï¿½RF _%ï¿½ to ï¿½_ map unitsï¿½ or ï¿½_ centiMorgansï¿½

19)  add Interactions03 04 p to Problems

4/23/14
working on
	8) in practice mode, the baloon help for a cage is "shows evidence of ..."
need to
	- make CageScorer have static only methods
	- move requirement for ModelBuilderUI out of it
	- test with new version
did all but testing the standard grading with a few problems

5/7/14
tested - OK

adding a "comments to instructor" in the model builder (for Julie Noor)
	- limited to 200 characters
	- need to "purify" string to prevent contamination of the xml
		convert to hex ascii (like at http://jovialjava.blogspot.com/2010/05/hex-to-ascii-conversion-in-java.html)
		but some characters are more than 1 byte... DO NOT USE
		- some websites say that JDom makes it safe
			so just try it
textarea keeps changing size - http://stackoverflow.com/questions/2454501/how-to-keep-size-of-jtextarea-constant
make "200 char limit" label say "N chars remaining" and make a hard cap on typing

working - need translations in spanish and french and to set up using them

sent for testing to 
	Julie Noor - she says OK
	Sophie Javerzat

5/12/14
added spanish and french translations of Comments to Instructor

need to replace korean fig0 with the one in Future - don't bother, Korean is a mess.

8/3/14
trying to make version 3.2.1 with new features
chi sqaured lib was broken
	added it as external jar

it won't compile! 
	BUILD FAILED ... Class not found: javac1.8

upgraded to new eclipse "luna" - but now the colors are all fucked up in eclipse

version 3.2.1 2014-08-03 14:28

big problem making the app
http://docs.oracle.com/javase/7/docs/technotes/guides/jweb/packagingAppsForMac.html
got appbundler.jar 1.0 and put in VGLII/lib
makes a functional app but it defaults to the user's home dir
need the parameter to pass - these are jvm options 
	-Duser.dir=$APP_ROOT
	seems to work
signed it as above
	actually, just did this:
		codesign -s "Developer ID Application: Brian White" -vf VGLII-3.2.1.app/
post on web and test

8/22/14
sigh - apple is f**ing with java again
the new jar bundler doesn't get paths right
VGLII on mac can't find the key files.
need to re-make with old jar bundler
found it in
/Volumes/TimeMachine2/Backups.backupdb/Brian Whiteâs Home Office iMac/2011-07-31-095555/Macintosh HD/usr/share/java/Tools
	Jar Bundler v 13.5.0
try it now
app won't run; gives error
	LSOpenURLsWithRole() failed with error -10810

try a newer Jar Bundler from
/Volumes/TimeMachine2/Backups.backupdb/Brian Whiteâs Home Office iMac/2013-08-18-094916/Macintosh HD/usr/share/java/Tools
version 14.5.0
same error

even newer version? not available
so this won't work.

need to put key files where they'll be found
tried putting student.key in every directory in the .app and launching and looking for "Save work for grading.." - never see it
need to put in diagnostic

weird
if you use the 			<option value="-Duser.dir=$APP_ROOT" /> in build.xml for target jar
it tries to look in VGLII-3.2.1.app/ for the file
	but, even if it's there, file.exists() returns FALSE!
somehow, changing the user.dir doesn't really work completley
without that flag, it defaults to looking in Users/brian/

works better if you change the KeyFileChecker and EncryptionTools to take files as arguments not filename strings
	fixed for student.key and instructor.key

the files are there but it claims they're not 

there seems to be a new version of jarbundler http://informagen.com/JarBundler/
	jarbundler-2.3.1.jar 
		put in lib
failed - app won't run
nuke the jarbundler thing

may have to go with jar file - but then can't put it in the dock.

tried replacing the VGLII.jar file in the .app - no good (error -10810)

8/23/14 probably, the best way is to pass in a command line parameter to VGL with the $app_root
then set things right at the start

try this
documentation for command line stuff from the appbundler https://java.net/downloads/appbundler/appbundler.html
use <argument value="-D$APP_ROOT" />
	put the "-D" as a flag

works!
need to test on
- os x as jar - OK
- linux
- windows - OK

don't post all new versions - only mac and call it 3.2.1a
notify user group

6/25/15
working on bugs/features

20) There's a likely bug in grading. If you have 2 traits, it can sometimes count the cage in the grader as though it rpvides evidence of 
	dominance for both when it only shows for one. For example: 
		1-leg purple body x 5-leg purple body gives
			several leg lengths, but all purple
	but the grader says that it provides evidence of dominance for BOTH leg number and body color
		it should only do leg number
	this may be because in AutoGrader.java line 54, it counts i by gene models
		but in CageScorer, it counts i by phenotypes

- test to see if this is true

- test in practice mode - the cages are scored right there
- test in graded mode - can't replicate problem...
CONCLUSION: user error

--------------------
21) There may be a bug in ModelBuilder
	when running VGL/Level10.pr2, if it gives you a 2-allele inc dom (3 phenos)
		it may have given blanks as though it was 3-allele inc dom (6 phenos)

From the website, VGL/Level10.pr2 is:
2- or 3- alleles; autosomal, XX/XY or ZZ/ZW sex-linked inheritance; simple-, incomplete-, circular-, or hierarchical- dominance.
try with VGL/Level09 - should be same thing with practice mode
keep pinging until you get a 2-allele inc dom

- yes, you can choose 3-allele inc dom for this, but since it asks for 6 phenos, it's clearly not the right choice
CONCLUSION: not a bug

--------------
22) From Cindy Passmore cpassmore@ucdavis.edu - add a "blood type" model. 3 alleles, 4 phenotypes with 2 dom and 1 codom
	make as specific "BloodTypeGeneModel"
		have specific option to get this type of problem (no need for an alternative)

need 
	a) GeneticModel
	b) ModelBuilderPanel
	c) WorkFileProcessor
	d) GeneticModelFactory

a) take ThreeAlleleCircularDominance and save as BloodTypeGeneModel

b) need to fix ThreeAllelePanel to add Blood type is a choice
	take ThreeCircPanel and save as BloodTypePanel
	
c) did it

d) make it a boolean to specify BloodType - no alternatives
	need to mess with ProblemTypeSpecification also
	
made problem files and put them in VGL/

seems to start and save OK

ModelBuilder isn't displaying right - need to fix


7/1/15
got it working - send out for testing. 

1/26/16
finally got test results and it works
make new version 3.3.0

made linux version
- steal VGL.sh and README.txt from version 3.2.1
- edit as needed
- chmod on VGL.sh and VGL.jar to execute
- remove .DS_Store's
- tar & gz the whole thing
	tar -czvf VGLII.tar.gz VGLII-3.3.0
- tried to test with virtualbox but couldn't get java to run at all - fail.

made windows version:
- use launch4j
	specify the jar and the .exe
	minimum java version 1.6.0
- just use mac's compress to see if that works to make VGLII.pc.zip
	it leaves in _MACOSX/ and .DS_Store
	this page says how to nix these: http://stackoverflow.com/questions/10924236/mac-zip-compress-without-macosx-folder
- try zip VGLII.pc.zip -x \*.DS_Store -r VGLII-3.3.0/
- unzip on pc & see what happens
- OK now

made mac version:
- use build.xml's "app" option
- edit build.xml for new version
- make app
- seems OK
- use apple-I to change icon
- need to sign 
	bash (won't work in tcsh)
	export CODESIGN_ALLOCATE="/Applications/Xcode.app/Contents/Developer/usr/bin/codesign_allocate"
	codesign -s "Developer ID Application: Brian White" -vf VGLII-3.3.0.app/
		fails - "Developer ID Application: Brian White: no identity found"

http://stackoverflow.com/questions/16036571/codesign-gives-always-no-identity-found-error-via-terminal
went to apple developer site
downloaded my certificate
double-clicked cert file - it's there
also 
bash-3.2$ certtool y | grep Developer\ ID
   Common Name     : Developer ID Certification Authority
   Common Name     : Developer ID Application: Brian White
so it looks OK...
https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingCertificates/MaintainingCertificates.html
went in and created all the identities
still NG
tried rebooting
NG
further info from http://stackoverflow.com/questions/16036571/codesign-gives-always-no-identity-found-error-via-terminal
security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) F736D6D09627F9FE4979476C7BF888A7A8ED1610 "iPhone Developer: Brian White (Z2RL756Y85)"
  2) 557CC66FC17A7B528B2D8FF7E6E7F50DE3062070 "iPhone Distribution: Brian White (RNA5B8HQ54)"
  3) 920D3E24430BD4B3214A10B08ABE4D23467EB4FF "Mac Developer: Brian White (Z2RL756Y85)"
  4) 4833052F96B053A2F446A6D83D6AB999F9E8CEFB "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     4 identities found

  Valid identities only
  1) F736D6D09627F9FE4979476C7BF888A7A8ED1610 "iPhone Developer: Brian White (Z2RL756Y85)"
  2) 557CC66FC17A7B528B2D8FF7E6E7F50DE3062070 "iPhone Distribution: Brian White (RNA5B8HQ54)"
  3) 920D3E24430BD4B3214A10B08ABE4D23467EB4FF "Mac Developer: Brian White (Z2RL756Y85)"
  4) 4833052F96B053A2F446A6D83D6AB999F9E8CEFB "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     4 valid identities found

tried:
 codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0.app/
VGLII-3.3.0.app/: signed bundle with Mach-O thin (x86_64) [edu.umb.vgl]

perhaps it woorked!
yes it did!

2/5/16
try to get Korean working
- move messages_ko_KR.properties from Future/ to src/VGL
- un-comment line 121 in VGLII.java - the line that adds Korean to the choices
- move "Future/new fig0.gif" to src/VGL.Help_kr/fig0.gif

seems to work - send it out for testing.

3/2/16
Annie Jiang finalizes fixes to Korean menu stuff and index.html in help

3/3/16
need to test to be sure that grading is still OK in english
works


=======
6/17/16
looking into ExclesiorJet native compiler. But, the mac os x apps need xterm - which fusses and needs to be installed.
"Certain Excelsior JET functionality involves running your natively compiled program in a terminal. On Linux, it 
employs xterm for that purpose. For now Excelsior JET for OS X also falls back to xterm, but future versions will 
either employ the standard OS X terminal emulator, Terminal.app, or will have the respective functionality 
reimplemented without such external dependencies."
- don't use it.

there's something else: JWrapper http://www.jwrapper.com/excelsior-jet-alternative.html
it includes a jre - so you won't need to install java
but will it trip anti-java warnings/blockage?
it is also not free.
see if there's an educational discount.

6/20/16
asked this:
	I'm a professor at UMass Boston. I have written two java applications used exclusively for teaching biology that 
	I distribute for free (http://vgl.umb.edu and http://aipotu.umb.edu). These are used around the world and one has 
	won an international award for educational software. I make no money from these. My users are having more and more 
	trouble with java installations etc so I'm looking to make native apps.
	My budget is extremely limited. I looked on your website and was unable to find out what features are present/absent 
	in the free version. Is there an educational discount or a discount for freeware that applies to your product?

Antony (contact@jwrapper.com) replied:
	Thanks for your interest in JWrapper.
	JWrapper Standard can be used for free subject to our license terms.  The features available in JWrapper Standard are 
	listed on the following page.  The features which are excluded are lower down the page under JWrapper Enterprise:
		http://www.jwrapper.com/compare.html
	I would imagine that JWrapper Standard would do everything you need to get native apps built and distributed.
	Our terms are available here: http://www.jwrapper.com/jwrapper-license-details.html

So it looks like it's worth a try.
	need .png for all images or it fails
	main class is VGL.VGLII

seems to work!

try building in the Problems/ folder
	first run is slow - maybe it's installing stuff
	it installs Problems/ into /Users/brian/Library/Application Support/JWrapper-VGLII/JWrapper-VGLII-00044609005-complete
there's a lot of stuff there:
ls -l
total 19544
-rwxr-xr-x  1 brian  staff       85 Jun 20 11:23 JWAppSpec-JWrapperJreCompatibilityApp
-rwxr-xr-x  1 brian  staff       98 Jun 20 11:23 JWAppSpec-JWrapper_Service_Management_App
-rwxr-xr-x  1 brian  staff    11437 Jun 20 11:23 JWAppSpec-VGLII
-rwxr-xr-x  1 brian  staff        1 Jun 20 11:23 JWAuxiliaryArchive-VGLII_os_jwmac64
-rw-r--r--  1 brian  staff      895 Jun 20 11:23 JWLaunchProperties-1466436187035-21
-rw-r--r--  1 brian  staff      861 Jun 20 11:24 JWLaunchProperties-1466436280743-22
-rw-r--r--  1 brian  staff      861 Jun 20 11:25 JWLaunchProperties-1466436350053-23
-rwxr-xr-x  1 brian  staff     3028 Jun 20 11:23 JWrapper-VGLII-ICNS.icns
-rwxr-xr-x  1 brian  staff    49390 Jun 20 11:23 JWrapper-VGLII-UninstallerICO.icopng
-rwxr-xr-x  1 brian  staff    25489 Jun 20 11:23 JWrapper-VGLII-splash.png
-rwxr-xr-x  1 brian  staff       11 Jun 20 11:23 JWrapper-VGLII-version.txt
-rwxr-xr-x  1 brian  staff       98 Jun 20 11:23 JWrapperLaunch
-rw-r--r--  1 brian  staff       12 Jun 20 11:23 JWrapperUseJRE
drwxrwxrwx  8 brian  staff      272 Jun 20 11:23 Problems
-rw-r--r--  1 brian  staff  8541337 Jun 20 11:23 VGLII.jar
drwxrwxrwx  3 brian  staff      102 Jun 20 11:23 VGLIIMacLauncher64.app
-rwxr-xr-x  1 brian  staff    46764 Jun 20 11:23 elev_mac
-rwxr-xr-x  1 brian  staff       11 Jun 20 11:23 jwBuildVersion
-rw-r--r--  1 brian  staff        0 Jun 20 11:23 jwFirstRun
-rwxrwxrwx  1 brian  staff       13 Jun 20 11:25 jwLastRun
-rwxr-xr-x  1 brian  staff      792 Jun 20 11:23 jwrapper_license
-rw-r--r--  1 brian  staff  1200279 Jun 20 11:23 jwrapper_utils.jar
-rwxr-xr-x  1 brian  staff    31556 Jun 20 11:23 libjwutils_macos32.jnilib
-rwxr-xr-x  1 brian  staff    27648 Jun 20 11:23 libjwutils_macos64.jnilib

hmmm, it may be working.

need to test to see if the new version runs when java is absent/disabled
	it looks like you have to delete the jre to do this test - dangerous!
	
but will it solve the problem: that people aren't allowed to install software on their computers...

tested on windows
	the first run is VERY slow - next are faster
	it installs stuff in Users\brian.white\AppData\Roaming\JWrapper-VGLII\JWrapper-VGL-00044609005-complete
	along with some other stuff

see if you can find some testers.

1/30/17
motherfuckers at apple zotted java again
from julie.noor@duke.edu
	My TAs just discovered that VGLII 3.3.0 has a glitch with MacOS Sierra (10.12.2).  Even when the 
	application file is in the same folder as the Problems folder and student.key file, there is no 
	"save work for grading" option and when starting a new problem, it doesn't default to opening the 
	Problems folder.  One TA played around and figured out that MacOS is opening the application in 
	a weird read-only temporary folder.  
	
for notes, see above 8/23/14

it looks like the -D option may not be working anymore.

from http://stackoverflow.com/questions/7838750/is-there-a-jvm-command-line-option-to-change-directory 
it may be necessary to say -Duser.dir=$APP_ROOT
	not -D$APP_ROOT

FWIW, the directory being used is 
	/private/var/folders/c9/781k1x753y545pmzpdr0s1l80000gp/T/AppTranslocation/74D6CE66-88E2-48A2-9F18-69E18542D541/d/

looked up AppTranslation
https://github.com/potionfactory/LetsMove/issues/56
says 
	As outlined at http://weblog.rogueamoeba.com/2016/06/29/sierra-and-gatekeeper-path-randomization/, macOS Sierra 
	introduces a new security feature called "Gatekeeper Path Randomization" (or "app translocation", as it's called 
	on the API level). The basic gist is that if you download and run a Gatekeeper app from the Downloads folder, 
	the OS will copy the app into a read-only disk image and run it from there instead. See the link above for more details.

	This applies until the user moves the app to any other location (not just the Applications folder), after which the 
	OS will just run the app normally. However, the move is only recognized if performed using the Finder. If you move 
	the app another way, e.g. using "mv" in the Terminal, the app will continue to be translocated when run, even if 
	it's in /Applications.

some other ideas from https://eclecticlight.co/2016/06/16/macos-sierra-will-break-many-installers-and-updaters/
	make a signed disk image?
		https://developer.apple.com/library/content/technotes/tn2206/_index.html#//apple_ref/doc/uid/DTS40007919-CH1-TNTAG18

more details at http://lapcatsoftware.com/articles/app-translocation.html

ask Julie to try moving the /Application folder - didn't work

also set up laptop to run Sierra

1/31/17
Options:
1) Build VGL for mac with all files in the app (since that's translocated as a unit)
	will need to have it detect mac/pc then
		if PC - look in same dir as .jar for the files
		if MAC - look in some dir higher up on tree (or search)
	will need to tell users to put key files INSIDE the app
	http://stackoverflow.com/questions/4032957/how-to-get-the-real-path-of-java-application-at-runtime
	
2) Sign a disk image of the whole set of stuff - maybe it'll translocate the whole package

try #2
make disk image https://support.apple.com/kb/ph5841?locale=en_US
use VGL files in "ReadyToRun/"
take the VGLII-3.3.0 folder
	Disk Utility
		File => new image from folder
	selected VGLII-3.3.0 folder
		read only format
	saved to desktop

sign it 
cd Desktop
codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0.dmg 
VGLII-3.3.0.dmg: signed  []

put it on website and test. http://vgl.umb.edu/VGLII/VGLII-3.3.0.dmg

it warned about an "unidentified developer" and it got relocated...
maybe the signing wasn't right 

check with spctl a la https://developer.apple.com/library/content/technotes/tn2206/_index.html#//apple_ref/doc/uid/DTS40007919-CH1-TNTAG18

spctl -a -t open --context context:primary-signature -v VGLII-3.3.0.dmg 
VGLII-3.3.0.dmg: rejected
source=Insufficient Context

so maybe I didnt' sign it right. Try again.
- maybe failed b/c the app was already singed
- maybe used wrong identity (got new keys, remember!)

see under 1/26/16
security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) F736D6D09627F9FE4979476C7BF888A7A8ED1610 "iPhone Developer: Brian White (Z2RL756Y85)" (CSSMERR_TP_CERT_EXPIRED)
  2) 557CC66FC17A7B528B2D8FF7E6E7F50DE3062070 "iPhone Distribution: Brian White (RNA5B8HQ54)" (CSSMERR_TP_CERT_EXPIRED)
  3) 920D3E24430BD4B3214A10B08ABE4D23467EB4FF "Mac Developer: Brian White (Z2RL756Y85)" (CSSMERR_TP_CERT_EXPIRED)
  4) 4833052F96B053A2F446A6D83D6AB999F9E8CEFB "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" (CSSMERR_TP_CERT_EXPIRED)
     4 identities found

  Valid identities only
     0 valid identities found

- no valid identities - I renewed my certs and downloaded at home
need to get them here
	go to http://developer.apple.com/account
	signin
	downloaded my iOS development certificate
	double-clicked the file

	no help

try getting the "Worldwide Developer Relations Certificate Authority" from my account's create new certificate page
it downloads a cert file "AppleWWDRCA.cer"
	double click it

still NG

try rebooting - NG

contacted developer support

2/1/17
In the long run, getting it in the app store is probably the best thing. You can build a JVM into the app also.

Apple replied:

Hello Brian, 

Thank you for contacting Apple Developer Program Support regarding your certificates.
I have a few resources to point you to regarding the certificate issue youâre experiencing. 
Please see the "Maintaining Your Signing Identities and Certificates" section of the App Distribution Guide for detailed 
instructions for replacing the certificate:
https://developer.apple.com/library/ios/documentation/IDEs/Conceptual/AppDistributionGuide/MaintainingCertificates/MaintainingCertificates.html

For troubleshooting assistance related to your certificates, you can see the âTroubleshootingâ section of the App Distribution Guide:
https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/Troubleshooting/Troubleshooting.html#//apple_ref/doc/uid/TP40012582-CH5-SW1

Lastly, I have another link that can be of assistance:
https://developer.apple.com/support/certificates/

I hope you find this information helpful. Please let me know if you have any questions or need any further assistance. I'm happy to help.

If you would like, give us a call: https://developer.apple.com/contact/phone.php 

When contacting us, please reference case number 100125753737.

Best regards,

Deborah
Apple Inc.

tried first link
	xcode => preferences
		sign into account
		need to create certs
		exported as "2017-02-01 Profile.developerprofile" used "Vasel..." password
		imported into Xcode

security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) F736D6D09627F9FE4979476C7BF888A7A8ED1610 "iPhone Developer: Brian White (Z2RL756Y85)" (CSSMERR_TP_CERT_EXPIRED)
  2) 557CC66FC17A7B528B2D8FF7E6E7F50DE3062070 "iPhone Distribution: Brian White (RNA5B8HQ54)" (CSSMERR_TP_CERT_EXPIRED)
  3) 920D3E24430BD4B3214A10B08ABE4D23467EB4FF "Mac Developer: Brian White (Z2RL756Y85)" (CSSMERR_TP_CERT_EXPIRED)
  4) 4833052F96B053A2F446A6D83D6AB999F9E8CEFB "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" (CSSMERR_TP_CERT_EXPIRED)
  5) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  6) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  7) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     7 identities found

  Valid identities only
  1) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  2) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  3) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     3 valid identities found

looks good.

try making disk image

1) make new folder /javastuff/ReadyToRun/VGL & VGLII/VGL II/Version 3.3.0a/
2) copy in "Mac Version/" from "Version 3.3.0/"
	rename internal folder to "VGLII-3.3.0a/"
	delete VGLII.app & VGLII.zip
3) in eclipse, remake the VGLII.app (click the "app" target)
	copy into the folder from (2)
	added icon
4) in disk utility
	create image from folder
		select "Mac Version/"
			read-only
		save as "VGLII-3.3.0a.dmg" in the "Version 3.3.0a/" folder
5) in "Version 3.3.0a/" folder
	codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0a.dmg 
gives:
3rd Party Mac Developer Application: Brian White (RNA5B8HQ54): ambiguous 
	(matches "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" 
	and "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" in /Users/brian/Library/Keychains/login.keychain)	

looks like I need to nuke the expired one. Follow directions on first link above under "Removing Signing Identities from Your Keychain"
	go to Keychain Access
		deleted expired Keys
		deleted expired Certificates

security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  2) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  3) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     3 identities found

  Valid identities only
  1) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  2) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  3) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
     3 valid identities found
- looks OK

try signing the .dmg

codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0a.dmg
VGLII-3.3.0a.dmg: signed  []
- not looking good

spctl -a -t open --context context:primary-signature -v VGLII-3.3.0a.dmg 
VGLII-3.3.0a.dmg: rejected
source=Insufficient Context
- it failed...

try remaking the .dmg as "compressed" - not "read only"

same result - NG

try the other identity (remake the .dmg as "compressed")
codesign -f -v -s "Mac Developer: Brian White (Z2RL756Y85)" VGLII-3.3.0a.dmg 
VGLII-3.3.0a.dmg: signed  []
spctl -a -t open --context context:primary-signature -v VGLII-3.3.0a.dmg
VGLII-3.3.0a.dmg: rejected
source=Insufficient Context

why failing?
- could it be that I'm on 10.11.5 - not the most advanced OS?

try doing it on laptop running 10.12
	get keys etc into Xcode using .developerprofile from above

first, on big mac, try signing a copy of the app
codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0.app/
VGLII-3.3.0.app/: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]
- that's better

spctl -a -t open --context context:primary-signature -v VGLII-3.3.0.app/
VGLII-3.3.0.app/: rejected
source=Insufficient Context
- odd.. maybe an incorrect command

OK - look at codesign - maybe wrong options?

or may be OK:
- made fresh .dmg
codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.0a.dmg 
VGLII-3.3.0a.dmg: signed  []

codesign --display --verbose=4 VGLII-3.3.0a.dmg 
Executable=/javastuff/ReadyToRun/VGL & VGLII/VGL II/Version 3.3.0a/VGLII-3.3.0a.dmg
Identifier=VGLII-3.3.0a
Format=disk image
CodeDirectory v=20200 size=300 flags=0x0(none) hashes=1+6 location=embedded
Hash type=sha256 size=32
CandidateCDHash sha256=61121ac294bebd5301598bfa37c031c3df200801
Hash choices=sha256
CDHash=61121ac294bebd5301598bfa37c031c3df200801
Signature size=4669
Authority=3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)
Authority=Apple Worldwide Developer Relations Certification Authority
Authority=Apple Root CA
Signed Time=Feb 1, 2017, 11:26:26 AM
Info.plist=not bound
TeamIdentifier=RNA5B8HQ54
Sealed Resources=none
Internal requirements count=1 size=192

try downloading on laptop running 10.12.3
	on mounting, OS claims it's from an unidentified developer
	open anyway
	copy to desktop
	run
	unidentified developer warning
		it got translocated...

last chance for this is to do the signing on the 10.12 mac
	tried - same errors - it got translocated..
	
need to make it translocation-proof

build all the stuff into the .app
	put it all in the Java folder.
first try - just make the app & move the stuff in there
1) build app new
2) copy to the "Mac Version/" folder from above
3) drag Problems/ into VGL.app/Contents/Java

NG - the program doesn't look there.

need to build it properly.

1) remove the  			<argument value="-D$APP_ROOT" />  line from build.xml
	it was used as a mac-specific signal
2) replace the code in VGLII.java near line 440 that checked for -D option
	change 		
	vglFolderDirectory = new File(System.getProperty("user.dir")); // for all but mac apps made by appbundler, this is the directory where VGL lives
	to something that'll get where the .jar is	
	http://stackoverflow.com/questions/4032957/how-to-get-the-real-path-of-java-application-at-runtime
try
	vglFolderDirectory = new File("."); // get directory where jar/exe is
NG - it goes to user's home dir

try 
			JOptionPane.showMessageDialog(null, this.getClass().getProtectionDomain().getCodeSource().getLocation());
	this gives a string: file:/Users/brian/git/JavaCodeFromSVN/VGLII/VGLII-3.3.0.app/Contents/Java/VGLII.jar
	so need to strip it and use it as the right path!
	
2/2/17
when doing this path thing, be sure to check:
1) it works on PC
2) be VERY careful - don't replace "file:" with "" - if they have file in the filename etc
	replace up through the first colon with ""
	replace after the last file separator with ""
	
made this a new version: 3.3.1

ugh - since getLocation() returns a URL, any spaces or strange char get turned to %20 etc..
	use URLdecoder

seems to work on mac
try signing

1) build app 3.3.1
2) copy to version 3.3.1 folder
3) show contents of app
4) copy in Problems/ to .app/Contents/Java/
5) sign

[briansofficemac:VGL II/Version 3.3.1/Mac version] brian% codesign -f -v -s "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)" VGLII-3.3.1.app/
VGLII-3.3.1.app/: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]

- looks OK

zip it and post it and download it and test it
it looks like it might be OK
send to Julie Noor to test.

test the .exe using jar
- use launch4j
	specify the jar and the .exe - save in 3.3.1/PC version
	minimum java version 1.6.0

NG - get error from launch4j - "registry refers to nonexistent java runtime environment..."
try getting latest launch4j - version 3.9 - (had version 3.0.2)
make new exe

use this to make zip  zip VGLII.pc.zip -x \*.DS_Store -r VGLII-3.3.1/

test on pc - no good. It opens into user's home.

need to debug path stuff

2/3/17
also - look into automating launch4j in eclipse http://launch4j.sourceforge.net/docs.html#Ant_task
	make an exe button

if you put this
		JOptionPane.showMessageDialog(null, vglFolderDirectory.getAbsolutePath());
in the VGL constructor, it gives the location of the .exe
but, strangely, open new problem opens into the user's docs folder..

try putting the dialog in the open prob file code to report problemsDirectory
it's looking for C:\Problems - why??

newProblemFromFile uses .toString() not .getAbsolutePath() - is that it? YES - fixed 
removed dialogs

test on mac - OK
build app
add back Problems/
sign
zip
- mac is ready for deployment - need to change website docs.

PC version use mac's zip command

problem - once the app is modified by Julie adding the key file you can't web distribute it anymore since the signing
is invalid

the only solution to this is to have the user select the key file directory manually when they first want to save work for
grading..

2/4/17
weird - even though Iâm a developer, when opening the app, you get the âunidentified developerâ error
https://github.com/electron-userland/electron-builder/issues/740
says "macOS app must be not signed using Mac Developer: cert. Only Developer ID Application: is valid.â
Iâve been using "3rd Party Mac Developer Application:â - is this wrong??

if you go in XCode  and select âOS Xâ - you see that âDeveloper ID Applicationâ is present

on home mac,
security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) 23E2F99F8CE497FFD37C1F088D0B7F639DA69ED8 "Developer ID Application: Brian White"
  2) 8291FE9B1EC3A27D6ABA032223C243D29630F856 "iPhone Developer: Brian White (Z2RL756Y85)"
     2 identities found

  Valid identities only
  1) 23E2F99F8CE497FFD37C1F088D0B7F639DA69ED8 "Developer ID Application: Brian White"
  2) 8291FE9B1EC3A27D6ABA032223C243D29630F856 "iPhone Developer: Brian White (Z2RL756Y85)"
     2 valid identities found

try signing the old VGLII-3.3.0 app - to see if it gets translocated
codesign -f -v -s "Developer ID Application: Brian White" VGLII-3.3.0.app/
VGLII-3.3.0.app/: resource fork, Finder information, or similar detritus not allowedâ

WTF?
https://developer.apple.com/library/content/qa/qa1940/_index.html

xattr -lr VGLII-3.3.0.app/ - shows a lot of cruft
xattr -cr VGLII-3.3.0.app/ - should nuke it
xattr -lr VGLII-3.3.0.app/ - now clean

try to sign
codesign -f -v -s "Developer ID Application: Brian White" VGLII-3.3.0.app/
VGLII-3.3.0.app/: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]
(took longer than usual)

put in zip & send up to server
download and test
NG
- still get unidentified developer and it is translocated

try under more controlled conditions at work

2/6/17
probably the best plan

1) check on why I'm getting the "unidentified developer"
	try the different identity
	contact tech support

2) Build VGL for mac with the Problems in the .app
	as for the key files
		- have the 'save for grading" and "grade students' work" present all the time
		- the first time you choose them, it looks for the key files in these places in this order
			(look for a "VGL" "VGLII" "VGL-3.3.1" folder with the right .key file(s) in it)
			(if it fails to find the appropriate .key file in one location, try the next, etc)
			a folder specified in preferences
			one of the following "canonical" locations
				User.home/Desktop
				User.home/Documents
				User.home/Downloads
				User.home/Applications
				Applications
			if not in any of these, pop up a dialog "VGL can't find necessary key files"
				do you want to cancel or show VGL where they are
					if "show where they are" - pop up file dialog for DIRECTORY
						save this to preferences
	this will be OK for windows too
3) when you do this - don't use File.toString() but File.getAbsolutePath() 

do with a "KeyFileLocator" class
	has preferences reader & writer
	keeps keyFileDirectory
	static methods that get key file paths
	deals with dialog box

2/7/17
revision
have it do the search on startup in canonical places
	- first look in directory with .jar or .exe
	- then prefs, if set
	- then canonical
	- if found, add corresponding menu items
	- if all not found, add File => Import Key Files
		opens dialog for FOLDER where all keys are
			reports what keys it found and what that means
			saves folder to prefs
build this into the startup key search

so, go back and look in VGLII.java to see how to integrate it there.

Nuke out KeyFileLocator code and put it in existing KeyFileChecker
also, simplify and assume all 3 keys in same folder

2/8/17
ALWAYS have "Import Key files..." - it just refreshes them.

look into the "unidentified developer" thing - made username brian.white.umb.edu for developer forums
	useless - other have this problem but not responses

sent in an apple tech support request 658885076

2/10/17
apple replied
Based on your request Apple Developer Technical Support believes that your question is answered by the âChecking Gatekeeper Conformanceâ 
section of the Technical Note TN2206 - âmacOS Code Signing In Depthâ linked here: 

https://developer.apple.com/library/content/technotes/tn2206/_index.html#//apple_ref/doc/uid/DTS40007919-CH1-TNTAG211

While a Technical Support Incident (TSI) was initially debited from your Apple Developer Program account for this request, 
we have assigned a replacement incident back to your account. However, if after reviewing this information you have further 
questions or persistent issues, please reply to this email and we will re-open this support inquiry, re-debiting a TSI accordingly.

the link goes to a page that suggests "If you're told that only apps from the Mac App Store or registered developers can be 
installed, your app isn't Developer ID-signed. Use the Xcode Organizer to export a Developer ID-signed copy of your app 
and repeat the test. It may also be that the system doesn't think your bundle is an app bundle because its Info.plist 
doesn't have its CFBundlePackageType property set to APPL."

in XCode Window=>Organizer, there's nothing there - probably because this isn't an Xcode project
the CFBundlePackageType is APPL
- so, somehow, it's not signed.

it goes on to say that the command below "mimics what Gatekeeper does to check your app"
	codesign --verify --deep --strict --verbose=2 Foo.app

theoretically, I signed VGLII-3.3.1.app; check it:
[briansofficemac:VGL II/Version 3.3.1/Mac version] brian% codesign --verify --deep --strict --verbose=2 VGLII-3.3.1.app/
VGLII-3.3.1.app/: valid on disk
VGLII-3.3.1.app/: satisfies its Designated Requirement
- so it should be OK
- so, why the fuss by gatekeeper?

got SignatureCheck from the apple developer site (link in the page above)
	put it in "Version 3.3.1/Mac version"

briansofficemac:VGL II/Version 3.3.1/Mac version] brian% ./check-signature VGLII-3.3.1.app
(c) 2014 Apple Inc.  All rights reserved.
test-requirement: code failed to satisfy specified code requirement(s)
VGLII-3.3.1.app: The target is not signed with Developer ID or by the Mac App Store.
NO
- so this one fails - this is consistent with gatekeeper behavior
so how to fix?

this was signed with the "3rd party mac developer" identity
try with the "Developer ID Application"
1) go to developer.apple.com and certificated and then to "OS X" 
2) download the "Developer ID Application" key & import into KeychainAccess
	no effect on result of "security find-identity -p codesigning"

try going to Xcode => preferences
	next to Developer ID Application is "reset" - clicked that
		it sent me to the developer web page for my account
		add mac certificate - type = "Developer ID"
		had to create a csr, used this info http://support.visiolink.com/hc/en-us/articles/200003861-How-to-Create-a-certificate-and-provisioning-for-signing-apps-iOS-
		downloaded the new cert & double-clicked

security find-identity -p codesigning

Policy: Code Signing
  Matching identities
  1) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  2) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  3) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
  4) 9F2745D422E872D85C4695D77939C395A4CF6356 "Developer ID Application: Brian White (RNA5B8HQ54)"
     4 identities found

  Valid identities only
  1) F77554783F36E4F28D440935B74677870092238A "iPhone Distribution: Brian White (RNA5B8HQ54)"
  2) FC50235377D94375B3E8C63E0BE1CC2C34332E5D "Mac Developer: Brian White (Z2RL756Y85)"
  3) 27BBF90E3A9B1164E737673E99EE1D0D8BE5D97E "3rd Party Mac Developer Application: Brian White (RNA5B8HQ54)"
  4) 9F2745D422E872D85C4695D77939C395A4CF6356 "Developer ID Application: Brian White (RNA5B8HQ54)"
     4 valid identities found
- now seems OK
try signing VGLII-3.3.1

1) in "Version 3.3.1/Mac version"
2) delete old .app and .zip
3) copy .app from git to this folder
4) add icon
5) copy in Problems/ folder to Contents/Java/
6) try to sign
[briansofficemac:VGL II/Version 3.3.1/Mac version] brian% codesign -f -v -s "Developer ID Application: Brian White (RNA5B8HQ54)" VGLII-3.3.1.app
VGLII-3.3.1.app: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]
7) test as above
[briansofficemac:VGL II/Version 3.3.1/Mac version] brian% ./check-signature VGLII-3.3.1.app
(c) 2014 Apple Inc.  All rights reserved.
YES
- looking good
8) zip it and put up on web
9) download to laptop (10.12) 
	unzip in Downloads/
	drag .app to Desktop
	double-click - only get "downloaded from internet" warning - YAHOO
	runs AOK (can't tell if translocated, though)

HAVE FIXED THE SIGNING THING!
------------

now for the find file thing.
have a boolean - showFileDialogIfNeeded - only set this when they choose File=>Import Key files

2/13/17
actually, since it's not translocated, there's no need for all of this
	you could actually go back to the last version

no need for preferences, the dialog, import key files, or the multi-directory search

but, to make it a little better, have it search for both Problems/ and the .key files in
	user.dir - where the JVM is running (the .exe dir on PC and the app dir on mac)
	this.getClass().getProtectionDomain().getCodeSource().getLocation() - where the jar is

did that and set up latest launch4j (v 3.9) exported fred.xml and try putting it into build.xml as "exe" task
	error "launch4jconfig" is undefined
ended up just making external launch4j.xml file

make some keys and test on mac
	user.dir doesn't work - it gives my home dir
	-D$APP_ROOT is no help

try "." instead of user.dir - NG
	it used to work - what did I do?

look on github and found it
		vglFolderDirectory = new File(System.getProperty("user.dir")); // for all but mac apps made by appbundler, this is the directory where VGL lives
		boolean saveToEdXServerEnabled = false;
		if ((args.length == 1) && args[0].startsWith("-D")) {
			String appRootDir = args[0].replace("-D", "");		// mode 1a (mac only)
			// need to chop off last directory /VGL-3.2.1.app to get to enclosing folder
			StringBuffer appDirBuffer = new StringBuffer();
			String[] parts = appRootDir.split("/");
			for (int i = 0; i < (parts.length - 1); i++) {
				appDirBuffer.append(parts[i]);
				appDirBuffer.append("/");
			}
			appDirBuffer.deleteCharAt(appDirBuffer.length() - 1);
			vglFolderDirectory = new File(appDirBuffer.toString());				
		} else {
			if ((args.length == 1) && args[0].equals(ED_X_MODE_NAME)) {	
				saveToEdXServerEnabled = true;					// mode 3
			} else if (args.length > 1) {
				saveToEdXServerEnabled = true;					// mode 4
			}
		}

- this passes in the parameter APP_ROOT which VGL reads to then apply

works on MAC

need to test on windows - AOK

2/14/17
make version 3.3.1
- mac version:
- copy app to folder in ReadyToRun
- add icon
- sign
in /javastuff/ReadyToRun/VGL & VGLII/VGL II/Version 3.3.1/Mac Version/VGLII-3.3.1
codesign -f -v -s "Developer ID Application: Brian White (RNA5B8HQ54)" VGLII-3.3.1.app
VGLII-3.3.1.app: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]

put check-signature one level up
cd ../
./check-signature VGLII-3.3.1/VGLII-3.3.1.app
(c) 2014 Apple Inc.  All rights reserved.
YES
- looks OK
- use "compress" to make the archive 
- rename it to VGLII.mac.zip

2/15/17
post to http://vgl.umb.edu/VGLII/testing/VGLII.mac.zip
doesn't work on 10.12 - need to see why.
get it to pop up a dialog with appRootDirPath + "\n" + jarPath
need to sign the .app (check with check-signature) and then .zip it (do on Desktop)
then put on web and download (VGLII/testing/VGLII-3.3.1.zip)
- the app alone is not being translocated

try making the signed app in a folder with Problems/
	zip; post; download (VGLII/testing/VGL.zip)
- it is translocated

hmm.. unless the WHOLE thing is signed, it gets translocated?

therefore, will need to deal with translocation sensibly

just have it try all the directories above until it finds Problems/
	then have it use that one for all the other files too
	if it can't - have it ask if they want to point to folder or quit and move files
	if want to find - set preferences via file dialog

should post 2 Mac versions
	- one as one single .app with Problems/ built in - for most people
	- one for grading with Problems/ in the folder with the app
		add a README.txt
			where you should put this folder in order for grading stuff to be found

will need to update website
	- no change to windows version
	- 2 mac versions
	- revised grading instructions
	- on mac - no need to warn them about security warning
	
*********************
Web-based grading for VGL
	- no keys at all
	- I only need to set up & maintain instructor accounts
	- students need web access to submit for grading
	
workflow:
- student
	- start VGL
	- choose "Submit work for grading"
	- it will pop up list of non-expired schools/classes
	- student chooses one
	- student enters name, ID#, password assigned by prof (same for all students in this class)
	- hit submit - it is saved to mysql server
- instructor
	- log in to website with password and username (set up by me based on their e-mail)
	- select course from their list
	- see web page of results sorted by name
	- delete results

on server:
- database of courses
	- instructor name
	- instructor password
	- student password
	- expiration date
- database of grade results
****************

2/17/17
working on Problems/ folder finder
needed to move all that code to main() since you need a visible UI present before you can pop up a file dialog
can't get the file dialog to show (even though all the other dialogs show)
maybe a thread thing...
need to do this carefully

first, move the code to a separate class ProblemFolderFinder


2/22/17

will need to revise web site
- Ethan Bolker is post tense at UMB
- for mac, there are 2 versions
	- single file no-grading
	- folder for grading
- for grading, things are special for mac

working on FileChooser not showing up 
	http://stackoverflow.com/questions/33599014/jfilechooser-not-showing
need to wrap in Runnable - try that
	unclear how to get the data out of the runnable...
	make a class ProblemFolderFileChooser

seems to be working - very hard to clear out the prefs.. 
	but it does remember them well

need to try with .app and translocation.
make "mac grader" (in a folder) and "pc" versions
sign the mac app
[briansofficemac:Version 3.3.1/Mac Grader Version/VGLII-3.3.1] brian% codesign -f -v -s "Developer ID Application: Brian White (RNA5B8HQ54)" VGLII-3.3.1.app
VGLII-3.3.1.app: signed app bundle with Mach-O thin (x86_64) [edu.umb.vgl]
[briansofficemac:Version 3.3.1/Mac Grader Version/VGLII-3.3.1] brian% 
[briansofficemac:Version 3.3.1/Mac Grader Version/VGLII-3.3.1] brian% cd ../
[briansofficemac:VGL II/Version 3.3.1/Mac Grader Version] brian% ls
VGLII-3.3.1	check-signature
[briansofficemac:VGL II/Version 3.3.1/Mac Grader Version] brian% ./check-signature VGLII-3.3.1/VGLII-3.3.1.app
(c) 2014 Apple Inc.  All rights reserved.
YES

zip the folder to VGLII-3.3.1.mac.zip
	post on http://vgl.umb.edu/VGLII/testing/VGLII-3.3.1.mac.zip
download to laptop with 10.12
drag zip to desktop from downloads
double-click
	it found Problems on its own
move VGL folder to Desktop/fred/
	it pops up file dialog to find problems - quit
put VGLII-3.3.1 back on Desktop/
changed folder to VGLII - AOK
put VGLII-3.3.1 into Documents/ - OK
put VGLII-3.3.1 into user/Applications - OK
put VGLII-3.3.1 into /Applications - 
put VGLII-3.3.1 back on Desktop
	changed name to VGL

to do
1) test with key files
2) test on PC
3) test on PC with key files
4) remove the System.out.println stuff in ProblemsFolderFinder
5) test putting in weird folder and preferences setting
	then move the folder and see what happens

did
4)
1) didn't work with student.key - no "Save Work for Grading..." option.
that's because you put finding Problems/ in the main() - after the constructor (when it looks for the keys)
move it back to constructor
- seems OK
remake and sign app & post as before
test with VGLII-3.3.1/ on desktop
it finds the keys but doesn't open the gr2 properly??

2/27/17
working on (1) - AOK now (must have been a goof-up with the keys)
do (5)
  on Desktop/ in xxx/ (lower case)
  - I had to point it to the folder
  - I quit and the prference was saved
  - could save for grading and grade
  - tried renaming folder to yyy/ and it can't find it (asks to be shown where)
  - rename folder to VGLII-3.3.1 - now it finds it AOK (doesn't ask to be shown where)
 SO - AOK on mac now
 - ask Julie Noor to check it out.
 
 need to do (2) and (3) on PC
 - first, make a PC version:
   - make the .exe
   - copy to the PC version folder
   - zip it zip VGLII.pc.zip -x \*.DS_Store -r VGLII-3.3.1/
   - posted as http://vgl.umb.edu/VGLII/testing/VGLII.pc.zip
  it finds the Problems/ folder but not student.key???

  hmmm...
  in KeyFileChecker, it treated VGLII.vglFolderPath as a String, not a File
  	did VGLII.vglFolderPath.getAbsolutePath() instead
  
  - need to re-make app and test on mac...
    - re-make app 
    - copy to ReadyToRun folder
    - add icon
    - sign & test signature as above
    - re-zip and post as http://vgl.umb.edu/VGLII/testing/VGLII-3.3.1.mac.zip
    - download and test
    	- 
  
  - also re-made the PC version
  	- as above, posted as http://vgl.umb.edu/VGLII/testing/VGLII.pc.zip
  	- tested with all 3 keys - AOK
  
  - set up to make Mac No-grader version
    - make folder MacNoGraderVersion
    - copy in .app
    - add icon
    - put Problems/ in .app/Content/Java/
    - sign that
    - zip it
    - post as http://vgl.umb.edu/VGLII/testing/VGL-3.3.1.NG.mac.zip
    - test on mac - OK
  
  set up new web site in temporary place "website/vgl 2017 revisions for OS X/" folder
  	grading.html
  	download.html
  	VGLII/getVGLII.html
    studentGrading.html
    instructorGrading.html
  
2/28/17
made linux version - post as http://vgl.umb.edu/VGLII/testing/VGLII.tar.gz
test on ubuntu
  	had to install java using these directions http://www.wikihow.com/Install-Oracle-Java-JRE-on-Ubuntu-Linux
  	- AOK (didn't test grading)

need to add a README.txt to the mac grader version
re-zipped to VGLII-3.3.1.mac.zip & posted to testing/

3/27/17
posted as version 3.3.2

10/12/17
setting up on Macbook for work in France
got launch4j from https://sourceforge.net/projects/launch4j/files/latest/download?source=files
launch4j-3.11-macosx-x86.tgz
unzipped and put in /Applications

won't build - needs linrary stuff (red exclamation mark on the project)
can't get commit working either
keep trying

had to reset a couple of times but it seems to be working now

need to get libraries working
in Properties/Java Build Path/Libraries 
   it couldn't find commons-math3-3.0
   	double-clicked the link and pointed it to the jar in VGLII/
now builds OK
try to get launch4j working
BUILD FAILED
/Users/brianwhite/git/JavaCodeFromSVN/VGLII/build.xml:46: net.sf.launch4j.BuilderException: Application jar doesn't exist.
but it is there - if I double-click it, I get a warning about unidentified developer
	if I ok that, it tries to run but dies with a StringOutOfBoundsException
googled that and got https://sourceforge.net/p/launch4j/bugs/172/
	it seems to be a Java9 problem that hasn't been fixed since July.
	aparrently, launch4j is not java9 compatible - fuck
probably have to go back to java8 for now - hopefully, that won't kill anything else

many techniques at https://stackoverflow.com/questions/21964709/how-to-set-or-change-the-default-java-jdk-version-on-os-x
	but most seem to change it just for the current shell
	only the last one really seems to do it globally but carelessly
	a better one https://www.howtogeek.com/230145/how-to-uninstall-java-on-mac-os-x/

plan:
	- add to super cross # of progeny box a checkbox (default checked) "automatically open summary chart"
		- if checked:
			- deselect all cages
			- select super cross cage only
			- display summary chart for the super cross

10/13/17
go back to java 8
	go into /Library/Java/JavaVirtualMachines/
	moved jdk-9.jdk/ to desktop
	sudo rm -fr /Library/Internet\ Plug-Ins/JavaAppletPlugin.plugin
	sudo rm -fr /Library/PreferencePanes/JavaControlPanel.prefpane
rebooted
can run launch4j from command line

BUT
BUILD FAILED
/Users/brianwhite/git/JavaCodeFromSVN/VGLII/build.xml:46: net.sf.launch4j.BuilderException: Application jar doesn't exist.
line 46 is "<launch4j configFile="launch4j.xml" />"

could try a different install of launch4j
	http://macappstore.org/launch4j/
1) ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)" < /dev/null 2> /dev/null
2) brew install launch4j
restart eclipse

which launch4j
/usr/local/bin/launch4j

it wasn't that it couldn't find launch4j
it was that it couldn't find VGLII.jar because I was using the full path in launch4j.xml 
	and I'm user brianwhite here and brian on my old mac
changed them to relative paths and it's now OK!

10/16/17
now on to changing superCross
look at classes
there are methods in SummaryChartManager to do the summary chart thingy automatically
	clearSelectedSet()
	addToSelected(CageUI)

got it working
tested on mac
- can make super cross with and without automatic summary chart OK
- can select several cages and then do a super cross with auto summary chart OK
- can save with super cross and re-open OK
- can do crosses after a super cross with auto summary chart OK
- can do crossed after a super cross without auto summary chart OK
- can do crosses in work saved after auto summary chart OK

10/18/17
fixed text spacing in SummaryChartUI when displaying chi2 and p values (added &nbsp;)
added French & Spanish translation of "Create summary chart" for the checkbox in VGLII line 1591
	tested english, spanish & french
	for Korean, for now, just used english
tested multiple summary charts in one problem and saving etc
	can have several functional summary charts at the same time - all OK

ready to make mac and PC versions (3.3.2)
edited launch4j.xml to make the name of the .exe be "VGLII.exe" (no version #) to make it 
	so I don't have to edit it every time