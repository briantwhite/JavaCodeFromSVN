Features Log:
History List:
- double-click to get menu of options
	to upper
	to lower
	add notes
	delete
	
Greenhouse in general:
	- can change names of .organism files in greenhouse folder
		next time they are loaded, the name in the greenhouse
		will match the filename (that way, you can re-name
		them after you've saved them).

Molecular Biology:
	- double-click on greenhouse member loads it into 
		gene expression panels
	- "save" folds proteins as necessary if they aren't already 
		before saving


Biochemistry:
	- double-click on greenhouse member loads it into
		folding windows
	- can't save proteins to greenhouse (DNA siquence is unclear)

Genetics:
	- single click an organism in greenhouse or genetics window
	    to toggle selection
	- mutate hits BOTH copies once and only once
		(3/4 chance of mutation; 1/4 chance that it is "changed" to same

----------------------------------------------------------
Work Log:

9/25/06
started from scratch
added in protex and genex
had to modify them so they made JPanels rather than JFrames
  since you can't add a JFrame to a JTabbedPane
  
9/27/06
worked on genex
- made it a 2-panel version
- parallel structure to protex
- nuked out printing, and black-and-white stuff
- nuked help and about

9/28/06 
working on genex
- trying to get folding button to work

12/6/06
added stuff for aligning sequences
got code from http://www.dina.dk/~sestoft/bsa/bsapplet.html
it was in one big file & therefore hard to use
broke into individual class files
use them like new NM(new BloSum50(), 8, seq1, seq2).domatch(new Output(), "message");

3/1?/07
added class molGenexp/CustomListSelectionModel
start of trying to make selections work better
this one just reports out the updating events

3/14/07
- made Green-1 (homozygous green) organism

in case organism gets messed up, the DNA sequences are:
 Green-1
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 
 Green
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTGGTGTCGGCAGTAGTAGGGGGCGT
 
 Red
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 
 White
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 
 also altered CustomListSelectionModel
 - commented out the print statements

***SAVED AS VERSION 0.8
-this version works
	- it has the ugly selection thing
	- it does not print debug messages to the console
 
- working on improved genetics selection management
-removed "location" integer from Organism (not needed since now in OrgAndLoc class)
	had to do lots of fixes
- got the genetics selection to work
- the double-click in genex & protex makes a HUGE list of errors...

3/16/07
- got it to work
 you need to make a new CustomListSelectionModel when switching panes
 otherwise you get the infininte loop of calls to setSelectedIndexes()
 - this is because the old object keeps some state info that needs to be cleared out
 	therefore, making a new one is the best way to clear it out

- fixed it so that any changes to greenhouse clears oal1 and oal2

3/27/07
bug: paste a sequence into genex & express it
	it folds the "previous" sequence, not the new one.

- fixed in GeneExpressionWindow - in load new sequence button listener
	use the instance variable currentGene (was a local variable)

used this to make the greenhouse of organisms shown on 3/14/07

bug: after adding to greenhouse from genex, the "add" button is disabled
fixed

6/15/07
bug: when resized, the aa table in protex can shrink vertically
fixed: added box layout and rigid vertical area

major refactoring
made superclasses of major types:

- Workbench = GeneticsWorkbench, protex, and genex 
	the big thing with both panels and the controls

- Workpanel = an individual window for a tray, folding one protein, one gene

- HistoryList = a generic history list

- HistListItem = a generic member of history list (eg a Tray)

implemented these for genetics first.

got proteins to work - but it broke 
	- the organisms in the greenhouse (need to remake)
	- the comparator (check the name of the class it looks for)

6/17/07
continued working
had to remake greenhouse
- working on comparator bug...
need to put in mge and SequenceComparatorMenuItemListener
to look for class biochem.BiochemistryWorkbench

now OK

implement refactoring and double-click hist list items for genex

NOTE!!! - the DNA hist list used to allow you to double-click to show the folded protein
now, we'll need to nuke this feature or make a special menu item....

this was the code:
			public void mouseClicked(MouseEvent e) {
				if (e.getClickCount() == 2) {
					ExpressedGene eg = 
						(ExpressedGene)getSelectedValue();
					FoldedPolypeptide fp = eg.getFoldedPolypeptide();
					JLabel colorChipForDialog = new JLabel("     ");
					colorChipForDialog.setOpaque(true);
					colorChipForDialog.setBackground(fp.getColor());
					colorChipForDialog.setBorder(new LineBorder(Color.BLACK));

					Object[] options = {"OK",
							new JLabel("Color:"),
							colorChipForDialog
					};
					JOptionPane.showOptionDialog(
							mge,
							"",
							"Protein Structure",
							JOptionPane.YES_OPTION,
							JOptionPane.INFORMATION_MESSAGE,
							fp.getFullSizePic(),
							options,
							options[0]);
				}
			}

6/19/07
- tried to fix genex bug: when you select a base off screen, it scrools back to show the first base
 scrollRectToVisible should work, but it doesn't...
 
 - refactoring:
 	- fix references to genex and protex to MolBiolWorkbench and BiochemistryWorkbench
 
 - fixed the HistListPopupMenu for mol bio to show the protein structure
 
 added a new allele: a white that produces no protein.
 this makes a new greenhouse set (red is not a heterozygote of red and white-null)
 
 the sequences are:
 Green-1
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 
 Green-2
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGTCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTGGTGTCGGCAGTAGTAGGGGGCGT
 
 Red
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
CAGCTATGACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 
 White
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 
 
changed orange to be 255,100,0 - to be more conspicuously different from yellow and red

called it version 1.1

6/20/07
BIG TROUBLE
while the program opens the greenhouse fine in eclipse
the "serial versions" don't match when you run it from the command line or double-clicking the jar
the jvm's are different....
how to fix this?

tried removing the serialVersionUID from Organism.java (that's the only place it appears)
NG

try getting latest java...
NG

note that the errors are always the same - even when I change Organism.java
java.io.InvalidClassException: javax.swing.ImageIcon$AccessibleImageIcon; local class incompatible: 
   stream classdesc serialVersionUID = -3994512798706967451, local class serialVersionUID = -1903458698681874148
   
forget it
just save Organisms as DNA seqences 
	one per line
	it will ignore any line that doesn't contain all AGCT
read them in and assemble them as they come in
have a progress bar for this.

this should be version 1.2
set version # and made a version in CVS

made mac and pc versions
in mac version, used JarBundler to make a .app
	right-click the .app
	"view contents"
	use bbedit to open Info.plist
	add:
		<key>CFBundleIdentifier</key>
        <string>edu.umb.MGX</string>
	now, this will act like a real application in the "restricted finder" list of applications

7/6/07
apply fixes from protex
1) improved speed
put in CVS

2) changed color coding of amino acids in biochem workshop

made version 1.3
put in cvs
tagged as version 1.3

set so that the greenhouse won't get wider if you stretch the whole thing

version 1.3.1
put in cvs
tagged as version 1.3.1

10/5/07
- it was crashing when people had more than 60 trays in the Genetics Workshop
due to OutOfMemoryError
(more info in notebook)
In Organism.java, was creating these massive int[] for each BufferedImage of the flower icon
could not get them garbage collected
- they were 500kb per tray!
so made a static iconCache in Organism to keep the icons we've made so far
  (indexed by color.toString())
now there are no more of these massive arrays
should be OK
try making many trays
made 100 & it was OK
tagged as version 1.3.2

10/18/07
working on new bug
if you make a lot of mutants, it runs out of memory
it's because of all the buffered images
therefore, when making mutants, don't make the images
- save the new organisms with the images as NULL
- if you open them in biochemworkbench, then draw the picx as necessary

started refactoring GridCanvas's paint() to allow for multiple entry points

10/19/07
- working on bug - extra scrolbar appears in BiochWBench when screen is small
 - OutputPalette already has a scroller so none is needed in BiochemWorkPanel
- fixed

- added genetic code table to MoBoworkbench

10/20/07
- working on mutant out-of-memory thing
need to get rid of the full-scale image when not needed
	biochem - not needed since it already re-draws protein from Grid when loading
	mobo - only need this re-draw when looking at protein big pic
start by deleteing the BigPic & set/get methods from FoldedPolypeptide
  (just save the thumbnail & the Grid)
  then clean up the resulting mess
  	(also, when getting images from ProteinImageFactory, 
  	  explicitly set images = null when done)
  	BiochemWorkpanel
  	MoBoWorkbench
  	MoBoWorkpanel
  	MutantGenerator
  	GreenhouseLoader
  	others..
 seems to work (10 cages of mutants are OK)
 
 with 10 mutant cages
          percent          live          alloc'ed  stack class
 rank   self  accum     bytes objs     bytes  objs trace name
    1 16.11% 16.11%   5636144   19  38716128   148 322916 int[]			**FULL SIZE
    2 15.56% 31.67%   5443664   19  39463808   148 323522 int[]			**FULL SIZE
    3  9.42% 41.09%   3296288  148   3296288   148 322962 int[]			**THUMB
    4  9.13% 50.22%   3193528  148   3193528   148 323562 int[]			**THUMB
    5  7.01% 57.23%   2453088 102212   2453088 102212 322610 biochem.GridPoint
    6  7.00% 64.23%   2449248 102052   2449248 102052 323426 biochem.GridPoint
    
TRACE 322916:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:21)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:70)
	java.lang.Thread.run(Thread.java:613)
**FULL SIZE PIC

TRACE 323522:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:21)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:71)
	java.lang.Thread.run(Thread.java:613)
*** FULL SIZE PIC

TRACE 322962:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:49)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:70)
	java.lang.Thread.run(Thread.java:613)
*** THUMB

TRACE 323562:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:49)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:71)
	java.lang.Thread.run(Thread.java:613)
***THUMB

probably OK - it made a lot of big pics (roughly as many 2x as the & of mutants) 
but all but 19 were nuked
	where did the 19 come from? (not gc'd yet?)

see what #s look like with 5 trays of mutants
10 + 13 + 14 + 17 + 19 = 73 mutants

          percent          live          alloc'ed  stack class
 rank   self  accum     bytes objs     bytes  objs trace name
    1 16.08% 16.08%   3105920   10  20413488    73 323501 int[]
    2 14.66% 30.74%   2831184    9  20294288    73 322894 int[]
    3  8.15% 38.89%   1574208   73   1574208    73 322940 int[]
    4  8.15% 47.04%   1573088   73   1573088    73 323541 int[]
    5  6.83% 53.87%   1319064 54961   1319064 54961 323405 biochem.GridPoint

looks like it's OK
it made 73x2 big pics, all but 19 of which were nuked
	(strange, this is ~1/2 of when it was 10 trays... )
but it takes MUCH less memory.

still strange - why does it keep some around?
WHATEVER
this is still MUCH better than before (see notebook)

version 1.3.3 (tagged)
 
10/24/07
- it wasn't seeing the genetic code table image
- fixed the jar access stuff
tagged as version 1.3.4

2/7/08
preparing to add evolution

1) clean up some useless crap
	- ppID in polypeptide - not needed
	- move colorModel up to a static final in MolGenExp
		requires lots of changes (but eliminates silly passing around)
	- move StandardTable up to static final in MolGen Exp
		ditto

2) move all amino acid painting code to one place - in AminoAcid
	steal code from FoldingServer & modify
	
3) Moved protein coloring algorithm into ColorModel so its all in one place

2/10/08
4) fixed Polypeptide to output a proteinString
	aa:direction:aa:direction etc.

5) edited PolypeptideFactory
	- remove useless ppID
	- move AminoAcidTable up to static field in MolGenExp
	- changed createSOlution to createFromProteinString - to make a protein from
		a protein string (see (4))

6) Made a FoldedProteinArchive
	- should access it in FoldingManager's fold(Arrtibutes attrib) method
	
2/12/08
7) got FoldedProteinArchive working
	- can get proteins in/out

needed to fix random update bug 
	background colors of hist list items not showing up
		need to button.setOpaque(true)
		now ok

2/17/08
got it to save FoldedProteinArchive to a zip file in the greenhouse on quitting
	(close window or File-->Quit)
	apple-q requires adding stuff from com.apple.eawt that was too much of a pain to add
	see http://lists.apple.com/archives/Java-dev/2004/Sep/msg00195.html
got it to read in the archive zip file

had to fix 2 strange bugs
it'd freeze when making mutants
	- if it found a 0 aa protein in the archive, HexGrid's constructor had a fit
		so made it skip out of 0 aas
	- the protein coloring routine sometimes returned null
		made the default be white
now OK

2/22/08
added features
- it warns you (instead of error) that there's nothing in the gene pool because you
	set the fitnesses to zero
- it lets you load the world with more than one organism (it randomly places all you select)
- clear selection in World when you switch into Evolution mode
- added mutation freqs dialog
	now can run without mutation

2/23/08
working on preferences and preferences panes


