Features Log:
History List:
- double-click to get menu of options
	to upper
	to lower
	add notes
	delete
	
Greenhouse in general:
	- can change names of .organism files in greenhouse folder
		next time they are loaded, the name in the greenhouse
		will match the filename (that way, you can re-name
		them after you've saved them).

Molecular Biology:
	- double-click on greenhouse member loads it into 
		gene expression panels
	- "save" folds proteins as necessary if they aren't already 
		before saving


Biochemistry:
	- double-click on greenhouse member loads it into
		folding windows
	- can't save proteins to greenhouse (DNA siquence is unclear)

Genetics:
	- single click an organism in greenhouse or genetics window
	    to toggle selection
	- mutate hits BOTH copies once and only once
		(3/4 chance of mutation; 1/4 chance that it is "changed" to same

----------------------------------------------------------
Work Log:

9/25/06
started from scratch
added in protex and genex
had to modify them so they made JPanels rather than JFrames
  since you can't add a JFrame to a JTabbedPane
  
9/27/06
worked on genex
- made it a 2-panel version
- parallel structure to protex
- nuked out printing, and black-and-white stuff
- nuked help and about

9/28/06 
working on genex
- trying to get folding button to work

12/6/06
added stuff for aligning sequences
got code from http://www.dina.dk/~sestoft/bsa/bsapplet.html
it was in one big file & therefore hard to use
broke into individual class files
use them like new NM(new BloSum50(), 8, seq1, seq2).domatch(new Output(), "message");

3/1?/07
added class molGenexp/CustomListSelectionModel
start of trying to make selections work better
this one just reports out the updating events

3/14/07
- made Green-1 (homozygous green) organism

in case organism gets messed up, the DNA sequences are:
 Green-1
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 
 Green
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTGGTGTCGGCAGTAGTAGGGGGCGT
 
 Red
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 
 White
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 
 also altered CustomListSelectionModel
 - commented out the print statements

***SAVED AS VERSION 0.8
-this version works
	- it has the ugly selection thing
	- it does not print debug messages to the console
 
- working on improved genetics selection management
-removed "location" integer from Organism (not needed since now in OrgAndLoc class)
	had to do lots of fixes
- got the genetics selection to work
- the double-click in genex & protex makes a HUGE list of errors...

3/16/07
- got it to work
 you need to make a new CustomListSelectionModel when switching panes
 otherwise you get the infininte loop of calls to setSelectedIndexes()
 - this is because the old object keeps some state info that needs to be cleared out
 	therefore, making a new one is the best way to clear it out

- fixed it so that any changes to greenhouse clears oal1 and oal2

3/27/07
bug: paste a sequence into genex & express it
	it folds the "previous" sequence, not the new one.

- fixed in GeneExpressionWindow - in load new sequence button listener
	use the instance variable currentGene (was a local variable)

used this to make the greenhouse of organisms shown on 3/14/07

bug: after adding to greenhouse from genex, the "add" button is disabled
fixed

6/15/07
bug: when resized, the aa table in protex can shrink vertically
fixed: added box layout and rigid vertical area

major refactoring
made superclasses of major types:

- Workbench = GeneticsWorkbench, protex, and genex 
	the big thing with both panels and the controls

- Workpanel = an individual window for a tray, folding one protein, one gene

- HistoryList = a generic history list

- HistListItem = a generic member of history list (eg a Tray)

implemented these for genetics first.

got proteins to work - but it broke 
	- the organisms in the greenhouse (need to remake)
	- the comparator (check the name of the class it looks for)

6/17/07
continued working
had to remake greenhouse
- working on comparator bug...
need to put in mge and SequenceComparatorMenuItemListener
to look for class biochem.BiochemistryWorkbench

now OK

implement refactoring and double-click hist list items for genex

NOTE!!! - the DNA hist list used to allow you to double-click to show the folded protein
now, we'll need to nuke this feature or make a special menu item....

this was the code:
			public void mouseClicked(MouseEvent e) {
				if (e.getClickCount() == 2) {
					ExpressedGene eg = 
						(ExpressedGene)getSelectedValue();
					FoldedPolypeptide fp = eg.getFoldedPolypeptide();
					JLabel colorChipForDialog = new JLabel("     ");
					colorChipForDialog.setOpaque(true);
					colorChipForDialog.setBackground(fp.getColor());
					colorChipForDialog.setBorder(new LineBorder(Color.BLACK));

					Object[] options = {"OK",
							new JLabel("Color:"),
							colorChipForDialog
					};
					JOptionPane.showOptionDialog(
							mge,
							"",
							"Protein Structure",
							JOptionPane.YES_OPTION,
							JOptionPane.INFORMATION_MESSAGE,
							fp.getFullSizePic(),
							options,
							options[0]);
				}
			}

6/19/07
- tried to fix genex bug: when you select a base off screen, it scrools back to show the first base
 scrollRectToVisible should work, but it doesn't...
 
 - refactoring:
 	- fix references to genex and protex to MolBiolWorkbench and BiochemistryWorkbench
 
 - fixed the HistListPopupMenu for mol bio to show the protein structure
 
 added a new allele: a white that produces no protein.
 this makes a new greenhouse set (red is not a heterozygote of red and white-null)
 
 the sequences are:
 Green-1
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGGCGGCAGTAGTAGGGGGCGT
 
 Green-2
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTACTGTCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTGGTGTCGGCAGTAGTAGGGGGCGT
 
 Red
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
CAGCTATGACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGTTCTGTCGGCAGTAGTAGGGGGCGT
 
 White
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
CAGCTATAACCGAGATTGATGTCTAGTGCGATAAGCCCCAAAGATCGGCACATTTTGTGCGCTATACAAAGGTTAGTGGTCTGTCGGCAGTAGTAGGGGGCGT
 
 
changed orange to be 255,100,0 - to be more conspicuously different from yellow and red

called it version 1.1

6/20/07
BIG TROUBLE
while the program opens the greenhouse fine in eclipse
the "serial versions" don't match when you run it from the command line or double-clicking the jar
the jvm's are different....
how to fix this?

tried removing the serialVersionUID from Organism.java (that's the only place it appears)
NG

try getting latest java...
NG

note that the errors are always the same - even when I change Organism.java
java.io.InvalidClassException: javax.swing.ImageIcon$AccessibleImageIcon; local class incompatible: 
   stream classdesc serialVersionUID = -3994512798706967451, local class serialVersionUID = -1903458698681874148
   
forget it
just save Organisms as DNA seqences 
	one per line
	it will ignore any line that doesn't contain all AGCT
read them in and assemble them as they come in
have a progress bar for this.

this should be version 1.2
set version # and made a version in CVS

made mac and pc versions
in mac version, used JarBundler to make a .app
	right-click the .app
	"view contents"
	use bbedit to open Info.plist
	add:
		<key>CFBundleIdentifier</key>
        <string>edu.umb.MGX</string>
	now, this will act like a real application in the "restricted finder" list of applications

7/6/07
apply fixes from protex
1) improved speed
put in CVS

2) changed color coding of amino acids in biochem workshop

made version 1.3
put in cvs
tagged as version 1.3

set so that the greenhouse won't get wider if you stretch the whole thing

version 1.3.1
put in cvs
tagged as version 1.3.1

10/5/07
- it was crashing when people had more than 60 trays in the Genetics Workshop
due to OutOfMemoryError
(more info in notebook)
In Organism.java, was creating these massive int[] for each BufferedImage of the flower icon
could not get them garbage collected
- they were 500kb per tray!
so made a static iconCache in Organism to keep the icons we've made so far
  (indexed by color.toString())
now there are no more of these massive arrays
should be OK
try making many trays
made 100 & it was OK
tagged as version 1.3.2

10/18/07
working on new bug
if you make a lot of mutants, it runs out of memory
it's because of all the buffered images
therefore, when making mutants, don't make the images
- save the new organisms with the images as NULL
- if you open them in biochemworkbench, then draw the picx as necessary

started refactoring GridCanvas's paint() to allow for multiple entry points

10/19/07
- working on bug - extra scrolbar appears in BiochWBench when screen is small
 - OutputPalette already has a scroller so none is needed in BiochemWorkPanel
- fixed

- added genetic code table to MoBoworkbench

10/20/07
- working on mutant out-of-memory thing
need to get rid of the full-scale image when not needed
	biochem - not needed since it already re-draws protein from Grid when loading
	mobo - only need this re-draw when looking at protein big pic
start by deleteing the BigPic & set/get methods from FoldedPolypeptide
  (just save the thumbnail & the Grid)
  then clean up the resulting mess
  	(also, when getting images from ProteinImageFactory, 
  	  explicitly set images = null when done)
  	BiochemWorkpanel
  	MoBoWorkbench
  	MoBoWorkpanel
  	MutantGenerator
  	GreenhouseLoader
  	others..
 seems to work (10 cages of mutants are OK)
 
 with 10 mutant cages
          percent          live          alloc'ed  stack class
 rank   self  accum     bytes objs     bytes  objs trace name
    1 16.11% 16.11%   5636144   19  38716128   148 322916 int[]			**FULL SIZE
    2 15.56% 31.67%   5443664   19  39463808   148 323522 int[]			**FULL SIZE
    3  9.42% 41.09%   3296288  148   3296288   148 322962 int[]			**THUMB
    4  9.13% 50.22%   3193528  148   3193528   148 323562 int[]			**THUMB
    5  7.01% 57.23%   2453088 102212   2453088 102212 322610 biochem.GridPoint
    6  7.00% 64.23%   2449248 102052   2449248 102052 323426 biochem.GridPoint
    
TRACE 322916:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:21)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:70)
	java.lang.Thread.run(Thread.java:613)
**FULL SIZE PIC

TRACE 323522:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:21)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:71)
	java.lang.Thread.run(Thread.java:613)
*** FULL SIZE PIC

TRACE 322962:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:49)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:70)
	java.lang.Thread.run(Thread.java:613)
*** THUMB

TRACE 323562:
	java.awt.image.DataBufferInt.<init>(DataBufferInt.java:41)
	java.awt.image.Raster.createPackedRaster(Raster.java:458)
	java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1015)
	java.awt.image.BufferedImage.<init>(BufferedImage.java:317)
	molGenExp.ProteinImageFactory.generateImages(ProteinImageFactory.java:49)
	genetics.MutantGenerator.mutateGene(MutantGenerator.java:153)
	genetics.MutantGenerator.run(MutantGenerator.java:71)
	java.lang.Thread.run(Thread.java:613)
***THUMB

probably OK - it made a lot of big pics (roughly as many 2x as the & of mutants) 
but all but 19 were nuked
	where did the 19 come from? (not gc'd yet?)

see what #s look like with 5 trays of mutants
10 + 13 + 14 + 17 + 19 = 73 mutants

          percent          live          alloc'ed  stack class
 rank   self  accum     bytes objs     bytes  objs trace name
    1 16.08% 16.08%   3105920   10  20413488    73 323501 int[]
    2 14.66% 30.74%   2831184    9  20294288    73 322894 int[]
    3  8.15% 38.89%   1574208   73   1574208    73 322940 int[]
    4  8.15% 47.04%   1573088   73   1573088    73 323541 int[]
    5  6.83% 53.87%   1319064 54961   1319064 54961 323405 biochem.GridPoint

looks like it's OK
it made 73x2 big pics, all but 19 of which were nuked
	(strange, this is ~1/2 of when it was 10 trays... )
but it takes MUCH less memory.

still strange - why does it keep some around?
WHATEVER
this is still MUCH better than before (see notebook)

version 1.3.3 (tagged)
 
10/24/07
- it wasn't seeing the genetic code table image
- fixed the jar access stuff
tagged as version 1.3.4

2/7/08
preparing to add evolution

1) clean up some useless crap
	- ppID in polypeptide - not needed
	- move colorModel up to a static final in MolGenExp
		requires lots of changes (but eliminates silly passing around)
	- move StandardTable up to static final in MolGen Exp
		ditto

2) move all amino acid painting code to one place - in AminoAcid
	steal code from FoldingServer & modify
	
3) Moved protein coloring algorithm into ColorModel so its all in one place

2/10/08
4) fixed Polypeptide to output a proteinString
	aa:direction:aa:direction etc.

5) edited PolypeptideFactory
	- remove useless ppID
	- move AminoAcidTable up to static field in MolGenExp
	- changed createSOlution to createFromProteinString - to make a protein from
		a protein string (see (4))

6) Made a FoldedProteinArchive
	- should access it in FoldingManager's fold(Arrtibutes attrib) method
	
2/12/08
7) got FoldedProteinArchive working
	- can get proteins in/out

needed to fix random update bug 
	background colors of hist list items not showing up
		need to button.setOpaque(true)
		now ok

2/17/08
got it to save FoldedProteinArchive to a zip file in the greenhouse on quitting
	(close window or File-->Quit)
	apple-q requires adding stuff from com.apple.eawt that was too much of a pain to add
	see http://lists.apple.com/archives/Java-dev/2004/Sep/msg00195.html
got it to read in the archive zip file

had to fix 2 strange bugs
it'd freeze when making mutants
	- if it found a 0 aa protein in the archive, HexGrid's constructor had a fit
		so made it skip out of 0 aas
	- the protein coloring routine sometimes returned null
		made the default be white
now OK

2/22/08
added features
- it warns you (instead of error) that there's nothing in the gene pool because you
	set the fitnesses to zero
- it lets you load the world with more than one organism (it randomly places all you select)
- clear selection in World when you switch into Evolution mode
- added mutation freqs dialog
	now can run without mutation

2/23/08
working on preferences and preferences panes
working on moving global defaults
working on moving generally-used methods (express, fold, etc) to MGEUtilities

got it working
moved gene expression to one place
working on doing this with protein
made fold take any string as an arg and automoatically figure out the right way to parse it

2/24/08
got server connection working
benchmarking:
- 10x10 world
- load all with green1
- all mut rates .01
- all fitnesses 5
- don't save archive between runs
run 10 generations (when "Generation 10" appears in window)
	- local folding: 5:40, 5:12, 4:26, 3:47
	- server folding: 1:40, 1:33, 1:51, 1:59
therefore 2-3 times faster with server
try with bigger world to see if a bigger factor

- 20x20 world
	- local 20:23
	- server 4:35
  looks even better
  
- 50x50 world
	-local: 1hr 52 mins only @ gen 8
		had a null pointer exception at BruteForceFolder.recurse(BruteForceFolder.java:125)
	- server failed - couldn't find it in the archive
		probably, in doing request to fold 1300+ sequences something got lost

3/16/08
added preferences to set world size without recompiling

3/18/08
moved all progress bars to bottom of main panel - modeless feedback

fixed bug in evolution
	a saved org wouldn't load into biochem (null pointer)
		because aaseq was MetTrpArg (no spaces)
	so used polypeptide factory's parsestringtoAAs method
	now AOK

5/21/08
renamed to Aipotu 0.8
turned off the folding server - not much speed improvement
	GlobalDefaults.foldingServerEnabled controls this

need to make buttons behave properly
can't access any menus or the Add.. button when running an evolution run

bug fixes
- could only save one organism from evolution world
  after saved, the Add.. button was disabled
  modified MGX's updateGeneticsButtonStatus
  
speed up mutation by not creating a string & doing substring every time
	just make String[4] AGCT to do it
	
allowed organism names to include <space>

made dumpWorld - saves world contents to csv file.

5/22/08
made loadWorld - loads from world file

want to have it use both processors to run faster
need to benchmark again (since fixing the mutation code)
- on laptop 10.5.2; 3Gb ram; 2.33ghz intel core duo
- run from Eclipse
- nothing else running
- 10x10 world
- load all with green1
- all mut rates .005
- all fitnesses 5
- don't save archive between runs
run 10 generations (when "Generation 10" appears in window)
- mins: 4:23  

5/24/08
fixed bug in World - could select "cells" outside of world.

resume benchmarking as 5/22
- mins 3:37, 4:40

to use both processors
1) find all sequences to be folded - put in object SequencesToBeFolded
2) for n processors, use n threads, each of which draws sequences from the
   Seqs2BFolded in a synchronized method
3) progress is total - (# left in Seqs2BFolded)
4) when the Seq2BFolded is empty; all done

will need to rearrange 
- no more Evolver threads; have ProtenFolder threads that draw from Seqs2BFolded
- keep Evolver, but don't make threads of it.

probably should use a BlockingQueue and a ThreadPool

5/26/08
fixed bug in setting save pix to directory preference - it would add a filename
and make it un savable
now, if the filechooser returns something other than a directory, the
parent directory is used.

made it version 0.9

got it to save images of the workpanels to the clipboard!
but - in evolution, the slider scales show up BUT NOT THE SLIDER thingy!
maybe use spinners - they'll take up less space anyway...

5/27/08
set it to use spinners
also added population count labels - to show # of each color
got counting to work!

5/28/08
set evolution table labels to bold underlined

now, try to use threadpool to use both processors
will need some serious rearrangement

when making parallel threads, the singleton FoldingManager gets really
  messed up - two threads using the same manager
so made it a regular class
	- nuke getInstance method
	- look for compilation errors & replace with new FoldingManager()
		BiochemWorkPanel
		ThinOrganism
		MolBiolWorkpanel
		Mutator
		ProteinUtilities

all other workpanels seem OK
but evolution locks up - requires force quit.

got it to work - it uses both procesors, BUT gui is unresponsive

5/29/08
put evolver in its own Thread
now works - uses both processors
but:
	1) progress bar is wrong
	2) stop makes an error
fixed (1)
fixed (2)
but now, progress bar has 2 problems
- it does not go back to 0 when Stop
- second run without switching out of Evolution flickers (like it's trying to do 0,n,0,n,..)

looks OK now
but strange bug
every once in a while, parseAcid gives an error that it can't find the amino acid "MSNRHILCSYTKVSVLAAVVKKKK"
(some long aa seq)
it looks like, instead of being fed a single char, it is getting the whole string
why??
it does not always happen...
put in a tracer in ProteinUtilities (the responsible calling routine)

somehow, the archive entry, instead of having aa;dir;aa;dir, is just having a protein sequence...
it's not in the saved archive
try saving the archive when it happens

strange, it blew up on
MSNRHILFAIQG
the entry in archive.txt is:
MSNRHILFAIQG;MSNRHILFAIQG;255/255/255
- no directions were inserted into the protein string 
(a normal entry looks like: MMSS;M: E:M: E:S: E:S:none:;255/255/255)
why!?!?
set up a flag on entry into archive if no ":" present
- it reports many!
     [java] bad one:MSSAISPIDRHILCAIIS MSSAISPIDRHILCAIIS java.awt.Color[r=255,g=255,b=255]
     [java] bad one:MSNRHILLV MSNRHILLV java.awt.Color[r=255,g=255,b=255]
     [java] bad one:MSS MSS java.awt.Color[r=255,g=255,b=255]
     [java] bad one:MSSR MSSR java.awt.Color[r=255,g=255,b=255]
     [java] the aa seq was-MSS-
     [java] biochem.FoldingException: acid not found. ACID: MSS TABLE: standard
- it only happened to gag on one..

it looks like, in Multi.. I was submitting the sequence to the DB twice
  since FoldingManager.fold automatically does it

5/30/08
but it runs soooo slowly
probably thread issues.
benchmark on office mac dual 2.5ghz G5 with 2gb ram
(with stuff running in background: word, firefox playing internet radio)
10x10
mut freqs all 0.005
start with green 1
all fitness = 5
10 generations = 7:16, 10:08

try setting numProcessors = 1;
10 generations = 12:00, 13:25

somewhat slower
but I'm using the threads wrong
1) make the receiver of folded sequences be a LinkedBlockingQueue
	- actually, can't do that since archive is a HashMap
	- so use Collections.synchronizedMap(archive) for access 
2) no need for thread pool 
3) use join() to wait for completion of the threads

now 7:49, 4:44

made version 1.0

runs very unreliably
null pointer exceptions
PUNT the thread stuff
- archived the semi-working code to a cd (in binder at home)

go back to old version
- fold as you go and folding server

5/31/08
go back to old version as above
(actually keep some changes & roll back others)
- make FoldingManager a singleton
- change stop to "pause" and start to "run"

seems OK
set default mutation rates lower

weird bug - only when saving pix of generations, the progress bar
   stops updating (and cursor goes back to normal) after the first generation
  probably because ALL the things that are called in Evolver
  need to be in Evolver (for thread stuff)
 - still NG (unclear why...)

added ability to show the colors of the two alleles in the upper left
  corner of each cell in the world
  
6/1/08
it runs a long time but always ends in random errors
probably bad thread safety.

try adding synchronization
first, benchmark the new version
on laptop thru Eclipse
10x10 - don't show stuff in corner
green 1
all = fitness
run until you see "generation 10"
all mut freq's 0.001
- 1:43, 1:38, 1:58

synchronize all methods in FoldedProteinArchive
benchmark again:
- 1:58, 1:30, 1:51
	no significant difference! good

now try a really long run to look for crashes

still does

the singletons are also trouble.
fix them to be multiples
	and be sure they're not shared with other objects
1) folding manager
	need to fix
		- biochemworkpanel
		- moboworkpanel
		- mutator
		- proteinUtilities
	need to move this out of ThinOrganism
		make ThinOrganismFactory that builds ThinOrganisms from incomplete ones
2) geneExpresser (also needed for ThinOrganism)

still fails
168 generations
     [java] Exception in thread "Thread-5" java.lang.NullPointerException
     [java] 	at biochem.BruteForceFolder.recurse(BruteForceFolder.java:125)
     [java] 	at biochem.IncrementalFolder.placeRestOfAcids(IncrementalFolder.java:74)
     [java] 	at biochem.BruteForceFolder.realFold(BruteForceFolder.java:107)
     [java] 	at biochem.Folder.fold(Folder.java:59)
     [java] 	at biochem.FoldingManager.foldPP(FoldingManager.java:393)
     [java] 	at biochem.FoldingManager.fold(FoldingManager.java:303)
     [java] 	at evolution.ThinOrganismFactory.foldOntoHexGrid(ThinOrganismFactory.java:100)
     [java] 	at evolution.ThinOrganismFactory.foldAndComputeColor(ThinOrganismFactory.java:91)
     [java] 	at evolution.ThinOrganismFactory.createThinOrganism(ThinOrganismFactory.java:51)
     [java] 	at evolution.Evolver.makeNextGeneration(Evolver.java:223)
     [java] 	at evolution.Evolver.run(Evolver.java:64)
     [java] 	at java.lang.Thread.run(Thread.java:613)

- thread 5!?!
try again to see if same error
ran to 1300+ generations OK! (but was runing very fast at end because most had no mRNA)

try again

generation 109
     [java] Exception in thread "Thread-3" java.lang.NullPointerException
     [java] 	at biochem.BruteForceFolder.recurse(BruteForceFolder.java:125)
     [java] 	at biochem.IncrementalFolder.placeRestOfAcids(IncrementalFolder.java:74)
     [java] 	at biochem.BruteForceFolder.realFold(BruteForceFolder.java:107)
     [java] 	at biochem.Folder.fold(Folder.java:59)
     [java] 	at biochem.FoldingManager.foldPP(FoldingManager.java:393)
     [java] 	at biochem.FoldingManager.fold(FoldingManager.java:303)
     [java] 	at evolution.ThinOrganismFactory.foldOntoHexGrid(ThinOrganismFactory.java:100)
     [java] 	at evolution.ThinOrganismFactory.foldAndComputeColor(ThinOrganismFactory.java:91)
     [java] 	at evolution.ThinOrganismFactory.createThinOrganism(ThinOrganismFactory.java:52)
     [java] 	at evolution.Evolver.makeNextGeneration(Evolver.java:223)
     [java] 	at evolution.Evolver.run(Evolver.java:64)
     [java] 	at java.lang.Thread.run(Thread.java:613)


same place - different generation

try synchronizing the World

ran 2460 generations overnight!
(but had not chnaged fitnesses as it ran...)
try again

6/2/08
ran on pc
died 2x after about 180 generations

C:\Documents and Settings\Brian\Desktop>java -jar MGX.jar
Exception in thread "Thread-5" java.lang.NullPointerException
        at biochem.BruteForceFolder.recurse(BruteForceFolder.java:125)
        at biochem.IncrementalFolder.placeRestOfAcids(IncrementalFolder.java:74)
        at biochem.BruteForceFolder.realFold(BruteForceFolder.java:107)
        at biochem.Folder.fold(Folder.java:59)
        at biochem.FoldingManager.foldPP(FoldingManager.java:393)
        at biochem.FoldingManager.fold(FoldingManager.java:303)
        at evolution.ThinOrganismFactory.foldOntoHexGrid(ThinOrganismFactory.java:100)
        at evolution.ThinOrganismFactory.foldAndComputeColor(ThinOrganismFactory.java:91)
        at evolution.ThinOrganismFactory.createThinOrganism(ThinOrganismFactory.java:52)
        at evolution.Evolver.makeNextGeneration(Evolver.java:223)
        at evolution.Evolver.run(Evolver.java:64)
        at java.lang.Thread.run(Unknown Source)

C:\Documents and Settings\Brian\Desktop>java -jar MGX.jar
Exception in thread "Thread-3" java.lang.NullPointerException
        at biochem.BruteForceFolder.recurse(BruteForceFolder.java:125)
        at biochem.IncrementalFolder.placeRestOfAcids(IncrementalFolder.java:74)
        at biochem.BruteForceFolder.realFold(BruteForceFolder.java:107)
        at biochem.Folder.fold(Folder.java:59)
        at biochem.FoldingManager.foldPP(FoldingManager.java:393)
        at biochem.FoldingManager.fold(FoldingManager.java:303)
        at evolution.ThinOrganismFactory.foldOntoHexGrid(ThinOrganismFactory.java:100)
        at evolution.ThinOrganismFactory.foldAndComputeColor(ThinOrganismFactory.java:91)
        at evolution.ThinOrganismFactory.createThinOrganism(ThinOrganismFactory.java:52)
        at evolution.Evolver.makeNextGeneration(Evolver.java:223)
        at evolution.Evolver.run(Evolver.java:64)
        at java.lang.Thread.run(Unknown Source)

same failures as before on mac...

the only thing left to deal with is the counts of each color
- keep the counts in a synchronized class
- updateCounts is currently in EvolutionWorkArea (out of the evolver thread, which calls it)
- try putting updateCounts in Evolver
	with a call-back to mge to let it know that there's a new generation


6/3/08
- but it runs AOK on the 2-processor mac
only dies on 1-processor pc
- so probably a thread thing

tried extensive refactoring to put just the folding in a thread
but GUI wouldn't update while waiting for join.

so go back to this version and try to get gui OK
(it still has the problem that the progress bar disappears...)

move Evolver and EvolverTimer from mgx to EvolWArea

it MAY be OK...

new bug
- in genex, a sequence w/o promoter or term shows a term highlighted
- OK fixed

run a long time on mac and pc

it still crashes on mac (office mac with 2 g5 processors and other stuff running..)
     [java] Exception in thread "Thread-3" java.lang.NullPointerException
     [java] 	at biochem.BruteForceFolder.recurse(BruteForceFolder.java:125)
     [java] 	at biochem.IncrementalFolder.placeRestOfAcids(IncrementalFolder.java:74)
     [java] 	at biochem.BruteForceFolder.realFold(BruteForceFolder.java:107)
     [java] 	at biochem.Folder.fold(Folder.java:59)
     [java] 	at biochem.FoldingManager.foldPP(FoldingManager.java:393)
     [java] 	at biochem.FoldingManager.fold(FoldingManager.java:303)
     [java] 	at evolution.ThinOrganismFactory.foldOntoHexGrid(ThinOrganismFactory.java:100)
     [java] 	at evolution.ThinOrganismFactory.foldAndComputeColor(ThinOrganismFactory.java:91)
     [java] 	at evolution.ThinOrganismFactory.createThinOrganism(ThinOrganismFactory.java:51)
     [java] 	at evolution.Evolver.makeNextGeneration(Evolver.java:222)
     [java] 	at evolution.Evolver.run(Evolver.java:67)
     [java] 	at java.lang.Thread.run(Thread.java:613)

try synchronizing the createThinOrganism methods

still NG

6/4/08
try synchronizing FoldingManager.fold()
first benchmark 10 generations on office PC (2.4ghz single processor 1gb ram win xp)
1:32, 1:45, 1:47

make change & rerun
1:19, 0:57, 1:22
- actually FASTER!
then run a looong time

still dies at 170 generations on office mac (dual g5)
on PC (single processor), it goes much longer (334) but still dies

made it look for Desktop directory in save pix and save world

try synchronizing Evolver.makeNextgeneration()

